<!DOCTYPE html><html lang="es-ES"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roamwise - Temporizador y Cuenta Atr√°s</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&amp;display=swap" rel="stylesheet">
<style>
:root{--pri:#2563eb;--pri-dk:#1d4ed8;--pri-lt:#dbeafe;--acc:#f59e0b;--bg:#f0f4f8;--card:#fff;--tx:#1e293b;--tx2:#64748b;--bdr:#e2e8f0;--rad:12px;--sh:0 4px 24px rgba(0,0,0,.07);--grn:#10b981;--red:#ef4444;--org:#f59e0b}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans TC',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;display:flex;flex-direction:column}
header{background:linear-gradient(135deg,var(--pri),var(--pri-dk));color:#fff;padding:0 24px;height:60px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:0 2px 12px rgba(37,99,235,.3)}
.logo{font-size:1.4rem;font-weight:700;letter-spacing:1px}.logo span{color:var(--acc)}
.hdr-r{display:flex;align-items:center;gap:12px}.hdr-r a{color:rgba(255,255,255,.85);text-decoration:none;font-size:.9rem}.hdr-r a:hover{color:#fff}
main{flex:1;max-width:820px;width:100%;margin:0 auto;padding:28px 16px}
.pg-title{text-align:center;font-size:1.6rem;font-weight:700;margin-bottom:12px;color:var(--pri-dk)}
.info-box{background:var(--pri-lt);border-left:4px solid var(--pri);border-radius:0 var(--rad) var(--rad) 0;padding:14px 18px;margin-bottom:20px;font-size:.9rem;color:var(--pri-dk);line-height:1.65;display:flex;gap:10px;align-items:flex-start}.info-box .ic{flex-shrink:0;font-size:1.15rem;margin-top:2px}

.timer-card{background:var(--card);border-radius:var(--rad);box-shadow:var(--sh);padding:28px 24px;margin-bottom:20px;position:relative}
.topic-input{width:100%;padding:13px 16px;border:2px dashed var(--bdr);border-radius:10px;font-size:1.15rem;font-family:inherit;text-align:center;background:transparent;color:var(--tx);font-weight:600;transition:.2s}
.topic-input:focus{outline:none;border-color:var(--pri);border-style:solid;background:var(--pri-lt)}
.topic-input::placeholder{color:var(--tx2);font-weight:400}

.toolbar{display:flex;align-items:center;justify-content:center;gap:12px;margin:18px 0 20px}
.mode-tog{display:flex;background:#f1f5f9;border-radius:10px;padding:4px;flex:0 1 380px}
.mode-btn{flex:1;padding:10px 14px;border:none;border-radius:8px;background:transparent;font-size:.9rem;font-family:inherit;cursor:pointer;transition:.2s;font-weight:500;color:var(--tx2);white-space:nowrap}
.mode-btn.active{background:var(--pri);color:#fff;box-shadow:0 2px 8px rgba(37,99,235,.3)}
.focus-btn{width:40px;height:40px;border-radius:10px;border:2px solid var(--bdr);background:#fff;cursor:pointer;font-size:1.1rem;display:flex;align-items:center;justify-content:center;transition:.2s;flex-shrink:0}
.focus-btn:hover{border-color:var(--pri);background:var(--pri-lt)}
body.focus .focus-btn{background:var(--pri);border-color:var(--pri);color:#fff}

.disp-area{display:flex;flex-direction:column}
.dblock{transition:opacity .2s}

/* Big time */
.time-val{font-weight:700;font-variant-numeric:tabular-nums;text-align:center;line-height:1.15;letter-spacing:2px;transition:color .3s,font-size .3s}
.main-v .time-val{font-size:5.5rem;padding:16px 0}
.mini-v .time-val{font-size:1.7rem;padding:6px 0}

/* Clock section */
.clock-date{text-align:center;font-size:1rem;color:var(--tx2);margin-bottom:14px}
.tz-row{display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap}
.tz-sel{padding:9px 32px 9px 12px;border:2px solid var(--bdr);border-radius:9px;font-size:.88rem;font-family:inherit;cursor:pointer;appearance:none;background:#fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2364748b' viewBox='0 0 16 16'%3E%3Cpath d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E") no-repeat right 10px center;transition:border-color .2s;color:var(--tx);max-width:220px}
.tz-sel:focus{outline:none;border-color:var(--pri)}
.utc-tag{font-size:.82rem;color:var(--tx2);background:#f1f5f9;padding:5px 10px;border-radius:6px;font-weight:600;white-space:nowrap}

.main-v .tz-row{margin-top:0}.mini-v .tz-row{margin-top:4px}
.mini-v .tz-sel{padding:6px 28px 6px 10px;font-size:.82rem;max-width:160px}
.mini-v .utc-tag{font-size:.78rem;padding:3px 8px}

/* Section separator */
.sec-sep{padding:20px 0 14px;order:2}
.sep-inner{display:flex;align-items:center;gap:12px}
.sep-line{flex:1;height:1px;background:var(--bdr)}
.sep-label{font-size:.85rem;color:var(--tx2);white-space:nowrap;font-weight:500}

/* Mini header */
.mini-hdr{font-size:.85rem;color:var(--tx2);font-weight:500;margin-bottom:4px;display:none;align-items:center;gap:6px}
.mini-v .mini-hdr{display:flex}

/* CD Inputs (main idle) */
.cd-inp-row{display:flex;align-items:center;justify-content:center;gap:6px;margin-bottom:16px}
.cd-num{display:flex;flex-direction:column;align-items:center;gap:4px}
.cd-num input{width:3.6ch;font-size:4rem;font-weight:700;text-align:center;border:2px solid var(--bdr);border-radius:12px;padding:8px 4px;font-family:inherit;font-variant-numeric:tabular-nums;color:var(--tx);transition:border-color .2s}
.cd-num input:focus{outline:none;border-color:var(--pri);box-shadow:0 0 0 3px rgba(37,99,235,.12)}
.cd-num small{font-size:.82rem;color:var(--tx2);font-weight:500}
.cd-colon{font-size:3.5rem;font-weight:700;color:var(--tx2);padding:0 2px;padding-bottom:22px}

/* CD Presets */
.cd-presets{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:14px}
.mini-v .cd-presets{flex-wrap:nowrap;overflow-x:auto;justify-content:flex-start;gap:6px;padding-bottom:4px;scrollbar-width:none;-webkit-overflow-scrolling:touch}
.mini-v .cd-presets::-webkit-scrollbar{display:none}
.pre-btn{padding:8px 14px;border:1.5px solid var(--bdr);border-radius:8px;background:#fff;font-size:.86rem;font-family:inherit;cursor:pointer;transition:.2s;font-weight:500;color:var(--tx);white-space:nowrap}
.pre-btn:hover{border-color:var(--pri);background:var(--pri-lt);color:var(--pri-dk)}
.pre-btn.pa{border-color:var(--pri);background:var(--pri);color:#fff}
.mini-v .pre-btn{padding:6px 11px;font-size:.8rem}
.pre-custom{background:var(--pri-lt)!important;color:var(--pri-dk)!important;border-color:var(--pri)!important}

/* CD Start */
.cd-start{width:100%;padding:14px;border:none;border-radius:10px;background:var(--grn);color:#fff;font-size:1.1rem;font-family:inherit;font-weight:600;cursor:pointer;transition:.2s;letter-spacing:1px}
.cd-start:hover{background:#059669;box-shadow:0 4px 16px rgba(16,185,129,.3)}
.cd-start:disabled{opacity:.4;cursor:not-allowed}

/* CD Progress */
.cd-prog{height:8px;background:#e2e8f0;border-radius:8px;overflow:hidden;margin:12px 0 16px}
.cd-prog-fill{height:100%;border-radius:8px;background:var(--pri);transition:width .3s linear,background .3s}
.cd-prog-fill.warn{background:var(--org)}
.cd-prog-fill.danger{background:var(--red)}

/* CD Controls */
.cd-ctrl{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.mini-v .cd-ctrl{gap:8px}
.ctrl-btn{padding:11px 22px;border:2px solid var(--bdr);border-radius:10px;background:#fff;font-size:.95rem;font-family:inherit;font-weight:600;cursor:pointer;transition:.2s;color:var(--tx);display:inline-flex;align-items:center;gap:6px}
.ctrl-btn:hover{border-color:var(--pri);color:var(--pri);background:var(--pri-lt)}
.ctrl-btn.primary{background:var(--pri);color:#fff;border-color:var(--pri)}
.ctrl-btn.primary:hover{background:var(--pri-dk)}
.mini-v .ctrl-btn{padding:7px 14px;font-size:.82rem}

/* CD Time color states */
.cd-warn{color:var(--org)!important}
.cd-danger{color:var(--red)!important}
.cd-pulse{animation:cdPulse .5s infinite alternate}
@keyframes cdPulse{from{opacity:1}to{opacity:.4}}

/* CD Done flash */
.cd-done-flash{animation:doneFlash .6s infinite alternate}
@keyframes doneFlash{from{color:var(--red)}to{color:var(--bdr)}}
.cd-done-text{text-align:center;font-size:1.5rem;font-weight:700;color:var(--red);margin:8px 0 16px}
.mini-v .cd-done-text{font-size:1rem;margin:4px 0 8px}

/* Finish Overlay */
.finish-ov{position:fixed;inset:0;z-index:500;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.3s}
.finish-ov.show{opacity:1;pointer-events:auto}
.finish-bg{position:absolute;inset:0;background:rgba(0,0,0,.55);animation:finBg .8s infinite alternate}
@keyframes finBg{from{background:rgba(239,68,68,.25)}to{background:rgba(239,68,68,.5)}}
.finish-card{position:relative;background:#fff;border-radius:20px;padding:48px 40px;text-align:center;max-width:420px;width:90%;box-shadow:0 24px 80px rgba(0,0,0,.3);animation:finPop .3s ease-out}
@keyframes finPop{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
.finish-emoji{font-size:4rem;margin-bottom:12px}
.finish-title{font-size:2rem;font-weight:700;color:var(--red);margin-bottom:8px}
.finish-topic{font-size:1.15rem;color:var(--tx2);margin-bottom:24px;min-height:1.4em}
.finish-dismiss{padding:14px 48px;border:none;border-radius:12px;background:var(--pri);color:#fff;font-size:1.1rem;font-family:inherit;font-weight:600;cursor:pointer;transition:.2s}
.finish-dismiss:hover{background:var(--pri-dk)}

/* Toast */
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(80px);background:#1e293b;color:#fff;padding:12px 24px;border-radius:10px;font-size:.9rem;z-index:600;opacity:0;transition:.35s;pointer-events:none;display:flex;align-items:center;gap:8px;white-space:nowrap}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1}

/* Tips */
.tips-card{background:var(--card);border-radius:var(--rad);box-shadow:0 2px 8px rgba(0,0,0,.05);border:1px solid var(--bdr);padding:22px 20px;margin-bottom:20px}
.tips-card h3{font-size:1rem;font-weight:600;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.tip-item{margin-bottom:10px;font-size:.9rem;line-height:1.7}.tip-item:last-child{margin-bottom:0}

/* Focus mode */
body.focus .hide-f{display:none!important}
body.focus main{max-width:100%;padding:3vh 5vw}
body.focus .timer-card{box-shadow:none;border-radius:0;min-height:85vh;display:flex;flex-direction:column;justify-content:center;padding:24px 32px}
body.focus .main-v .time-val{font-size:clamp(4rem,18vw,14rem)}
body.focus .topic-input{font-size:clamp(1.2rem,3vw,2.2rem);border:none;margin-bottom:12px}
body.focus .mini-v{display:none!important}
body.focus .sec-sep{display:none!important}
body.focus .toolbar{margin:10px 0 16px}
body.focus .cd-num input{font-size:clamp(3rem,12vw,8rem)}
body.focus .cd-colon{font-size:clamp(2.5rem,10vw,7rem)}

footer{background:#1e293b;color:rgba(255,255,255,.7);padding:32px 24px 18px;margin-top:auto}
.ft-grid{max-width:820px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:24px;margin-bottom:24px}
.ft-col h4{color:#fff;font-size:.92rem;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.ft-col a{display:block;color:rgba(255,255,255,.6);text-decoration:none;font-size:.85rem;padding:3px 0;transition:.2s}.ft-col a:hover{color:#fff}
.ft-col a.al{color:var(--acc);font-weight:500}
.ft-bot{text-align:center;border-top:1px solid rgba(255,255,255,.1);padding-top:14px;font-size:.8rem}.ft-bot a{color:rgba(255,255,255,.5);text-decoration:none}.ft-bot a:hover{color:#fff}

@media(max-width:640px){
    .timer-card{padding:20px 16px}
    .main-v .time-val{font-size:3.2rem}
    .cd-num input{font-size:2.5rem;width:2.8ch}
    .cd-colon{font-size:2.2rem;padding-bottom:18px}
    .toolbar{flex-wrap:wrap}
    .mode-tog{flex:1 1 100%;order:1}
    .focus-btn{order:2}
    .pg-title{font-size:1.3rem}
    .finish-card{padding:36px 24px}
    .finish-emoji{font-size:3rem}
    .finish-title{font-size:1.5rem}
}
</style>
</head>
<body>

<header>
    <div class="logo">
        <img src="logo.png" alt="Roamwise Logo" class="logo-img">
        Roam<span>wise</span>
    </div>
    <div class="logo">Roam<span>wise</span></div>
    <div class="header-right">
        <a href="#" class="contact-link">Cont√°ctenos</a>
        <select class="lang-select" id="langSelect">
            <option value="timer-zh.html">Chino tradicional</option>
            <option value="timer-en.html">Ingl√©s</option>
            <option value="timer-es.html" selected="">Espa√±ol</option>
            <option value="timer-pt.html">Portugu√©s</option>
        </select>
    </div>
</header>
    
<script>
    function changeLanguage(filename) {
        window.location.href = filename;
    }
</script>

<main>
<h1 class="pg-title hide-f">‚è±Ô∏è Temporizador y Cuenta Atr√°s</h1>
<div class="info-box hide-f"><span class="ic">‚ÑπÔ∏è</span><div>Compatible con <strong>reloj en tiempo real</strong> y <strong>cuenta atr√°s</strong>, ideal para ex√°menes, reuniones, presentaciones y m√°s. Introduce un nombre de tema y cambia de modo para comenzar. Soporta <strong>130+</strong> zonas horarias de ciudades de todo el mundo. Haz clic en üî≥ para entrar en modo de enfoque y ampliar la pantalla.</div></div>

<div class="timer-card" id="timerCard">
    <input type="text" class="topic-input" id="topic" placeholder="Introduce el nombre del tema (ej: Examen Parcial, Reuni√≥n por la Tarde)" maxlength="60">

    <div class="toolbar">
        <div class="mode-tog">
            <button class="mode-btn active" id="modeClk" onclick="setMode('clock')">üïê Modo Reloj</button>
            <button class="mode-btn" id="modeCd" onclick="setMode('countdown')">‚è≥ Modo Cuenta Atr√°s</button>
        </div>
        <button class="focus-btn" id="focusBtn" onclick="toggleFocus()" title="Modo de Enfoque">üî≥</button>
    </div>
    <div class="disp-area" id="dispArea">

        <!-- ===== CLOCK BLOCK ===== -->
<div id="clockBlock" class="dblock main-v" style="order:1">
            <div class="mini-hdr"><span>üïê</span> Hora Actual</div>
            <div class="time-val" id="clockTime">--:--:--</div>
            <div class="clock-date big-only" id="clockDate" style=""></div>
            <div class="tz-row">
                <select class="tz-sel" id="tzSel" onchange="onTzChange()"></select>
                <span class="utc-tag" id="utcTag">UTC+8</span>
            </div>
        </div>

        <!-- ===== SEPARATOR ===== -->
        <div class="sec-sep" id="secSep">
            <div class="sep-inner"><div class="sep-line"></div><span class="sep-label" id="sepLabel">‚è≥ Cuenta Atr√°s</span><div class="sep-line"></div></div>
        </div>

        <!-- ===== COUNTDOWN BLOCK ===== -->
        <div id="cdBlock" class="dblock mini-v" style="order:3">
            <div class="mini-hdr"><span>‚è≥</span> Cuenta Atr√°s</div>

            <!-- IDLE -->
<div id="cdIdle">
                <div class="cd-inp-row big-only" id="cdInpRow">
                    <div class="cd-num"><input id="cdH" type="text" inputmode="numeric" value="00" maxlength="2"><small>h</small></div>
                    <span class="cd-colon">:</span>
                    <div class="cd-num"><input id="cdM" type="text" inputmode="numeric" value="25" maxlength="2"><small>m</small></div>
                    <span class="cd-colon">:</span>
                    <div class="cd-num"><input id="cdS" type="text" inputmode="numeric" value="00" maxlength="2"><small>s</small></div>
                </div>
                <div class="cd-presets" id="cdPresets"></div>
                <button class="cd-start big-only" id="cdStartBtn" onclick="startCd()">‚ñ∂ Iniciar Cuenta Atr√°s</button>
            </div>

            <!-- ACTIVE (running/paused) -->
            <div id="cdActive" style="display:none">
                <div class="time-val" id="cdTime">00:25:00</div>
                <div class="cd-prog big-only" id="cdProgWrap"><div class="cd-prog-fill" id="cdProgFill"></div></div>
                <div class="cd-ctrl">
                    <button class="ctrl-btn primary" id="cdPauseBtn" onclick="togglePause()">‚è∏ Pausa</button>
                    <button class="ctrl-btn" onclick="resetCd()">üîÑ Reiniciar</button>
                </div>
            </div>

            <!-- FINISHED -->
            <div id="cdDone" style="display:none">
                <div class="time-val cd-done-flash" id="cdDoneTime">00:00:00</div>
                <div class="cd-done-text">‚è∞ Alerta de Fin de TiempoÔºÅ</div>
                <div class="cd-ctrl"><button class="ctrl-btn primary" onclick="resetCd()">üîÑ Reiniciar</button></div>
            </div>
        </div>
    </div>
</div>

<<div class="tips-card hide-f">
    <h3>üí° Consejos de Uso</h3>
    <p class="tip-item">üñ•Ô∏è <strong>Modo de Enfoque</strong>: Haz clic en el bot√≥n üî≥ de la barra de herramientas para entrar en modo de enfoque, que oculta informaci√≥n innecesaria y ampl√≠a la pantalla de tiempo. Perfecto para proyecciones en aulas o salas de conferencias.</p>
    <p class="tip-item">‚è≥ <strong>Cuenta Atr√°s R√°pida</strong>: En modo reloj, el √°rea de cuenta atr√°s a continuaci√≥n proporciona botones de preestablecimiento r√°pido. Haz clic para iniciar la cuenta atr√°s sin necesidad de cambiar de modo.</p>
    <p class="tip-item">üîî <strong>Alerta de Fin de Tiempo</strong>: Cuando finaliza la cuenta atr√°s, recibir√° notificaciones de sonido y alertas de pantalla completa para asegurarse de no perd√©rselo. Los √∫ltimos 60 segundos cambiar√°n de color como advertencia.</p>
    <p class="tip-item">üåç <strong>Cambio de Zona Horaria</strong>: Compatible con 130+ zonas horarias de ciudades de todo el mundo, ideal para reuniones internacionales y confirmar la hora local de los participantes en diferentes regiones.</p>
    <p class="tip-item">üìù <strong>Etiqueta de Tema</strong>: Introduce un nombre de examen o tema de reuni√≥n en el campo de texto anterior para facilitar la identificaci√≥n. El nombre del tema tambi√©n aparecer√° en la pantalla de alerta cuando finalice la cuenta atr√°s.</p>
</div>

</main>

<footer>
    <div class="footer-grid">
        <div class="footer-col">
            <h4>üîå Electricidad y Hora</h4>
            <a href="plug/plug-es.html">B√∫squeda de Especificaciones de Enchufe</a>
            <a href="time-zone/time-zone-es.html" class="active-link">B√∫squeda de Zona Horaria</a>
            <a href="sunset/sunset-es.html">Horarios de Amanecer y Atardecer</a>
        </div>
        <div class="footer-col">
            <h4>üéâ Festivos y Festivales</h4>
            <a href="#">D√≠as Festivos por Pa√≠s</a>
            <a href="#">Resumen de Eventos Festivos</a>
        </div>
        <div class="footer-col">
            <h4>üí± Finanzas y Unidades</h4>
            <a href="currency/currency-es.html">Conversi√≥n de Divisas</a>
            <a href="unit/unit-es.html">Conversi√≥n de Unidades</a>
        </div>
        <div class="footer-col">
            <h4>üåç Informaci√≥n de Viaje</h4>
            <a href="#">Resumen por Pa√≠s</a>
            <a href="#">Gu√≠as Locales Detalladas</a>
        </div>
    </div>
    <div class="footer-bottom">¬© 2026 Roamwise. Todos los derechos reservados. | <a href="#">Pol√≠tica de Privacidad</a> | <a href="#">T√©rminos de Uso</a></div>
</footer>

<!-- Finish Overlay -->
<div class="finish-ov" id="finishOv">
    <div class="finish-bg"></div>
    <div class="finish-card">
        <div class="finish-emoji">‚è∞</div>
        <div class="finish-title">¬°Se acab√≥ el tiempo!</div>
        <div class="finish-topic" id="finishTopic"></div>
        <button class="finish-dismiss" onclick="dismissFinish()">Aceptar</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ============ TIMEZONE DATA ============
const TZ=[
['üåè East Asia',[['Taipei','Asia/Taipei'],['Hong Kong','Asia/Hong_Kong'],['Macau','Asia/Macau'],['Beijing','Asia/Shanghai'],['Shanghai','Asia/Shanghai'],['Tokyo','Asia/Tokyo'],['Osaka','Asia/Tokyo'],['Seoul','Asia/Seoul'],['Ulaanbaatar','Asia/Ulaanbaatar']]],
['üåè Southeast Asia',[['Singapore','Asia/Singapore'],['Kuala Lumpur','Asia/Kuala_Lumpur'],['Bangkok','Asia/Bangkok'],['Jakarta','Asia/Jakarta'],['Manila','Asia/Manila'],['Ho Chi Minh City','Asia/Ho_Chi_Minh'],['Hanoi','Asia/Ho_Chi_Minh'],['Yangon','Asia/Yangon'],['Phnom Penh','Asia/Phnom_Penh'],['Vientiane','Asia/Vientiane'],['Brunei','Asia/Brunei']]],
['üåè South Asia',[['New Delhi','Asia/Kolkata'],['Mumbai','Asia/Kolkata'],['Kolkata','Asia/Kolkata'],['Chennai','Asia/Kolkata'],['Colombo','Asia/Colombo'],['Dhaka','Asia/Dhaka'],['Kathmandu','Asia/Kathmandu'],['Karachi','Asia/Karachi'],['Islamabad','Asia/Karachi']]],
['üåè Central Asia',[['Almaty','Asia/Almaty'],['Tashkent','Asia/Tashkent'],['Ashgabat','Asia/Ashgabat'],['Bishkek','Asia/Bishkek'],['Dushanbe','Asia/Dushanbe']]],
['üåç Western Asia / Middle East',[['Dubai','Asia/Dubai'],['Abu Dhabi','Asia/Dubai'],['Riyadh','Asia/Riyadh'],['Doha','Asia/Qatar'],['Kuwait City','Asia/Kuwait'],['Manama','Asia/Bahrain'],['Muscat','Asia/Muscat'],['Tehran','Asia/Tehran'],['Baghdad','Asia/Baghdad'],['Jerusalem','Asia/Jerusalem'],['Amman','Asia/Amman'],['Beirut','Asia/Beirut'],['Damascus','Asia/Damascus'],['Ankara','Europe/Istanbul'],['Istanbul','Europe/Istanbul']]],
['üåç Western Europe',[['London','Europe/London'],['Paris','Europe/Paris'],['Berlin','Europe/Berlin'],['Amsterdam','Europe/Amsterdam'],['Brussels','Europe/Brussels'],['Vienna','Europe/Vienna'],['Zurich','Europe/Zurich'],['Geneva','Europe/Zurich'],['Luxembourg','Europe/Luxembourg'],['Frankfurt','Europe/Berlin'],['Munich','Europe/Berlin'],['Dublin','Europe/Dublin']]],
['üåç Southern Europe',[['Madrid','Europe/Madrid'],['Barcelona','Europe/Madrid'],['Rome','Europe/Rome'],['Milan','Europe/Rome'],['Lisbon','Europe/Lisbon'],['Athens','Europe/Athens'],['Belgrade','Europe/Belgrade'],['Zagreb','Europe/Zagreb']]],
['üåç Northern Europe',[['Stockholm','Europe/Stockholm'],['Oslo','Europe/Oslo'],['Copenhagen','Europe/Copenhagen'],['Helsinki','Europe/Helsinki'],['Reykjavik','Atlantic/Reykjavik'],['Tallinn','Europe/Tallinn'],['Riga','Europe/Riga']]],
['üåç Eastern Europe',[['Moscow','Europe/Moscow'],['Saint Petersburg','Europe/Moscow'],['Kyiv','Europe/Kyiv'],['Minsk','Europe/Minsk'],['Warsaw','Europe/Warsaw'],['Prague','Europe/Prague'],['Budapest','Europe/Budapest'],['Bucharest','Europe/Bucharest'],['Sofia','Europe/Sofia']]],
['üåé North America',[['New York','America/New_York'],['Washington D.C.','America/New_York'],['Los Angeles','America/Los_Angeles'],['Chicago','America/Chicago'],['Houston','America/Chicago'],['Phoenix','America/Phoenix'],['San Francisco','America/Los_Angeles'],['Seattle','America/Los_Angeles'],['Denver','America/Denver'],['Miami','America/New_York'],['Boston','America/New_York'],['Toronto','America/Toronto'],['Vancouver','America/Vancouver'],['Montreal','America/Toronto'],['Anchorage','America/Anchorage'],['Honolulu','Pacific/Honolulu']]],
['üåé Central America',[['Mexico City','America/Mexico_City'],['Panama City','America/Panama'],['San Jose','America/Costa_Rica'],['Havana','America/Havana'],['Kingston','America/Jamaica']]],
['üåé South America',[['Sao Paulo','America/Sao_Paulo'],['Rio de Janeiro','America/Sao_Paulo'],['Buenos Aires','America/Argentina/Buenos_Aires'],['Santiago','America/Santiago'],['Lima','America/Lima'],['Bogota','America/Bogota'],['Quito','America/Guayaquil'],['Caracas','America/Caracas'],['Montevideo','America/Montevideo']]],
['üåç Africa',[['Cairo','Africa/Cairo'],['Lagos','Africa/Lagos'],['Nairobi','Africa/Nairobi'],['Johannesburg','Africa/Johannesburg'],['Cape Town','Africa/Johannesburg'],['Casablanca','Africa/Casablanca'],['Addis Ababa','Africa/Addis_Ababa'],['Accra','Africa/Accra'],['Tunis','Africa/Tunis'],['Algiers','Africa/Algiers']]],
['üåè Oceania',[['Sydney','Australia/Sydney'],['Melbourne','Australia/Melbourne'],['Brisbane','Australia/Brisbane'],['Perth','Australia/Perth'],['Auckland','Pacific/Auckland'],['Wellington','Pacific/Auckland'],['Suva','Pacific/Fiji'],['Noumea','Pacific/Noumea']]]
];

const PRESETS=[5,10,15,20,25,30,45,60,90,120];
const PRESETS_MINI=[5,10,15,25,30,60];

// ============ STATE ============
let mode='clock'; // clock | countdown
let tz='Asia/Taipei';
let cdState='idle'; // idle | running | paused | finished
let cdTotalMs=0,cdRemainMs=0,cdStartTs=0,cdElapsed=0;
let tickId=null;

// ============ DOM ============
const $=id=>document.getElementById(id);
const clockBlock=$('clockBlock'),cdBlock=$('cdBlock');
const clockTime=$('clockTime'),clockDate=$('clockDate');
const tzSel=$('tzSel'),utcTag=$('utcTag');
const cdIdle=$('cdIdle'),cdActive=$('cdActive'),cdDone=$('cdDone');
const cdTimeEl=$('cdTime'),cdDoneTime=$('cdDoneTime');
const cdProgFill=$('cdProgFill'),cdProgWrap=$('cdProgWrap');
const cdPauseBtn=$('cdPauseBtn'),cdStartBtn=$('cdStartBtn');
const sepLabel=$('sepLabel');
const finishOv=$('finishOv'),finishTopic=$('finishTopic');
const toastEl=$('toast');

// ============ INIT TZ SELECT ============
(function buildTzSel(){
    let html='';
    TZ.forEach(([group,cities])=>{
        html+='<optgroup label="'+group+'">';
        cities.forEach(([name,tzid])=>{
            const sel=tzid===tz?' selected':'';
            html+='<option value="'+tzid+'" data-city="'+name+'"'+sel+'>'+name+'</option>';
        });
        html+='</optgroup>';
    });
    tzSel.innerHTML=html;
})();

// ============ INIT PRESETS ============
(function buildPresets(){
    const box=$('cdPresets');
    let html='';
    PRESETS.forEach(m=>{
        const label=m>=60?(m/60)+' hours':m+' min';
        html+='<button class="pre-btn" onclick="applyPreset('+m+',this)">'+label+'</button>';
    });
    // Mini custom button
    html+='<button class="pre-btn pre-custom mini-only-btn" onclick="setMode(\'countdown\')" style="display:none">‚öô Custom</button>';
    box.innerHTML=html;
    updatePresetVisibility();
})();

function updatePresetVisibility(){
    const isMini=cdBlock.classList.contains('mini-v');
    const btns=$('cdPresets').querySelectorAll('.pre-btn');
    btns.forEach(b=>{
        if(b.classList.contains('mini-only-btn')){
            b.style.display=isMini?'':'none';
            return;
        }
        const m=parseInt(b.textContent);
        if(isMini){
            const label=b.textContent.replace('hours','').replace('m','');
            const min=b.textContent.includes('hours')?parseInt(label)*60:parseInt(label);
            b.style.display=PRESETS_MINI.includes(min)?'':'none';
        }else{
            b.style.display='';
        }
    });
}

// ============ CD INPUT SETUP ============
['cdH','cdM','cdS'].forEach(id=>{
    const el=$(id);
    el.addEventListener('input',()=>{el.value=el.value.replace(/\D/g,'').slice(0,2)});
    el.addEventListener('blur',()=>{
        let v=parseInt(el.value)||0;
        const mx=id==='cdH'?99:59;
        v=Math.min(Math.max(v,0),mx);
        el.value=String(v).padStart(2,'0');
    });
    el.addEventListener('focus',()=>el.select());
});

// ============ MODE ============
function setMode(m){
    mode=m;
    $('modeClk').classList.toggle('active',m==='clock');
    $('modeCd').classList.toggle('active',m==='countdown');
    updateLayout();
}

function updateLayout(){
    const cm=mode==='clock';
    clockBlock.className='dblock '+(cm?'main-v':'mini-v');
    cdBlock.className='dblock '+(cm?'mini-v':'main-v');
    clockBlock.style.order=cm?1:3;
    cdBlock.style.order=cm?3:1;
    sepLabel.textContent=cm?'‚è≥ Cuenta Atr√°s':'üïê Hora Actual';
    // big-only / mini-only via parent class
    const bigOnlys=document.querySelectorAll('.big-only');
    // We handle this purely via CSS parent class already in most cases
    // But for the cd input row and start btn we need to show/hide
    $('cdInpRow').style.display=(!cm&&cdState==='idle')?'flex':'none';
    cdStartBtn.style.display=(!cm&&cdState==='idle')?'':'none';
    clockDate.style.display=cm?'':'none';
    cdProgWrap.style.display=(!cm&&cdState==='running'||!cm&&cdState==='paused')?'':'none';
    updatePresetVisibility();
    updateCdStateUI();
}

function toggleFocus(){
    document.body.classList.toggle('focus');
}

// ============ CLOCK ============
function getClockTime(){
    try{
        return new Date().toLocaleTimeString('en-GB',{timeZone:tz,hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false});
    }catch(e){return '--:--:--'}
}
function getClockDate(){
    try{
        return new Date().toLocaleDateString('zh-TW',{timeZone:tz,year:'numeric',month:'long',day:'numeric',weekday:'long'});
    }catch(e){return ''}
}
function getUTC(){
    try{
        const now=new Date();
        const u=new Date(now.toLocaleString('en-US',{timeZone:'UTC'}));
        const t=new Date(now.toLocaleString('en-US',{timeZone:tz}));
        const diff=(t-u)/3600000;
        const h=Math.floor(Math.abs(diff));
        const m=Math.round((Math.abs(diff)-h)*60);
        const sign=diff>=0?'+':'-';
        return 'UTC'+sign+String(h).padStart(2,'0')+(m?':'+String(m).padStart(2,'0'):'');
    }catch(e){return 'UTC'}
}

function onTzChange(){
    tz=tzSel.value;
    utcTag.textContent=getUTC();
}

// ============ COUNTDOWN ============
function applyPreset(min,btnEl){
    // Remove active from all
    $('cdPresets').querySelectorAll('.pre-btn').forEach(b=>b.classList.remove('pa'));
    if(btnEl)btnEl.classList.add('pa');

    const isMini=cdBlock.classList.contains('mini-v');
    const h=Math.floor(min/60),m=min%60;
    if(!isMini){
        $('cdH').value=String(h).padStart(2,'0');
        $('cdM').value=String(m).padStart(2,'0');
        $('cdS').value='00';
    }else{
        startCd(h,m,0);
    }
}

function startCd(h,m,s){
    if(h===undefined){
        h=parseInt($('cdH').value)||0;
        m=parseInt($('cdM').value)||0;
        s=parseInt($('cdS').value)||0;
    }
    cdTotalMs=(h*3600+m*60+s)*1000;
    if(cdTotalMs<=0)return;
    cdRemainMs=cdTotalMs;
    cdElapsed=0;
    cdStartTs=Date.now();
    cdState='running';
    updateLayout();
}

function togglePause(){
    if(cdState==='running'){
        cdElapsed+=Date.now()-cdStartTs;
        cdState='paused';
    }else if(cdState==='paused'){
        cdStartTs=Date.now();
        cdState='running';
    }
    updateCdStateUI();
}

function resetCd(){
    cdState='idle';cdRemainMs=0;cdTotalMs=0;cdElapsed=0;
    dismissFinish();
    updateLayout();
}

function updateCdStateUI(){
    const idle=cdState==='idle',active=cdState==='running'||cdState==='paused',done=cdState==='finished';
    cdIdle.style.display=idle?'':'none';
    cdActive.style.display=active?'':'none';
    cdDone.style.display=done?'':'none';

    if(active){
        const paused=cdState==='paused';
        cdPauseBtn.textContent=paused?'‚ñ∂ ÁπºÁ∫å':'‚è∏ Êö´ÂÅú';
        cdPauseBtn.classList.toggle('primary',true);
    }

    const isMini=cdBlock.classList.contains('mini-v');
    $('cdInpRow').style.display=(!isMini&&idle)?'flex':'none';
    cdStartBtn.style.display=(!isMini&&idle)?'':'none';
    cdProgWrap.style.display=(!isMini&&active)?'':'none';
}

function fmtMs(ms){
    const t=Math.ceil(ms/1000);
    const h=Math.floor(t/3600),m=Math.floor((t%3600)/60),s=t%60;
    return String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
}

function onFinish(){
    playBeep();
    const topic=$('topic').value.trim();
    finishTopic.textContent=topic||'';
    finishOv.classList.add('show');
}

function dismissFinish(){
    finishOv.classList.remove('show');
}

// ============ AUDIO ============
function playBeep(){
    try{
        const ac=new(window.AudioContext||window.webkitAudioContext)();
        function b(freq,start,dur){
            const o=ac.createOscillator(),g=ac.createGain();
            o.connect(g);g.connect(ac.destination);
            o.frequency.value=freq;o.type='sine';
            g.gain.setValueAtTime(0.35,ac.currentTime+start);
            g.gain.exponentialRampToValueAtTime(0.01,ac.currentTime+start+dur);
            o.start(ac.currentTime+start);o.stop(ac.currentTime+start+dur);
        }
        b(880,0,.25);b(880,.35,.25);b(1320,.7,.45);
    }catch(e){}
}

// ============ TICK ============
let lastSec=-1;
function tick(){
    // Clock
    const tStr=getClockTime();
    if(clockTime.textContent!==tStr){
        clockTime.textContent=tStr;
        const curSec=parseInt(tStr.split(':')[2]);
        if(curSec!==lastSec){
            clockDate.textContent=getClockDate();
            utcTag.textContent=getUTC();
            lastSec=curSec;
        }
    }

    // Countdown
    if(cdState==='running'){
        const elapsed=cdElapsed+(Date.now()-cdStartTs);
        cdRemainMs=Math.max(0,cdTotalMs-elapsed);
        if(cdRemainMs<=0){
            cdState='finished';cdRemainMs=0;
            onFinish();updateCdStateUI();
            return;
        }
        const str=fmtMs(cdRemainMs);
        cdTimeEl.textContent=str;

        // Colors
        cdTimeEl.classList.remove('cd-warn','cd-danger','cd-pulse');
        cdProgFill.classList.remove('warn','danger');
        if(cdRemainMs<=10000){
            cdTimeEl.classList.add('cd-danger','cd-pulse');
            cdProgFill.classList.add('danger');
        }else if(cdRemainMs<=60000){
            cdTimeEl.classList.add('cd-warn');
            cdProgFill.classList.add('warn');
        }

        // Progress
        const pct=((cdTotalMs-cdRemainMs)/cdTotalMs)*100;
        cdProgFill.style.width=pct+'%';
    }
}

tickId=setInterval(tick,150);

// ============ KEYBOARD ============
document.addEventListener('keydown',e=>{
    if(e.key==='Escape'&&document.body.classList.contains('focus')){
        document.body.classList.remove('focus');
    }
    // Don't handle space if typing in input
    if(e.target.tagName==='INPUT'||e.target.tagName==='SELECT')return;
    if(e.key===' '&&(cdState==='running'||cdState==='paused')){
        e.preventDefault();togglePause();
    }
});

// ============ TOAST ============
function showToast(msg){
    toastEl.textContent=msg;toastEl.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t=setTimeout(()=>toastEl.classList.remove('show'),2000);
}

// ============ INIT ============
updateLayout();
tick();
</script>


</body></html>
