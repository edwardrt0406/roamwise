<!DOCTYPE html><html lang="zh-Hant"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roamwise - Conversor de Divisas</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&amp;display=swap" rel="stylesheet">
    <style>
        :root{--primary:#2563eb;--primary-dark:#1d4ed8;--primary-light:#dbeafe;--accent:#f59e0b;--bg:#f0f4f8;--card:#fff;--text:#1e293b;--text-light:#64748b;--border:#e2e8f0;--radius:12px;--shadow:0 4px 24px rgba(0,0,0,.07);--shadow-sm:0 2px 8px rgba(0,0,0,.05);--green:#10b981;--red:#ef4444}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans TC',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column}
        header{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;padding:0 24px;height:60px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:0 2px 12px rgba(37,99,235,.3)}
        .logo{font-size:1.4rem;font-weight:700;letter-spacing:1px;display:flex;align-items:center;gap:8px}.logo span{color:var(--accent)}
        .header-right{display:flex;align-items:center;gap:16px}
        .header-right a{color:rgba(255,255,255,.85);text-decoration:none;font-size:.9rem;transition:color .2s}.header-right a:hover{color:#fff}
        .lang-select{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.3);color:#fff;padding:6px 12px;border-radius:8px;font-size:.85rem;cursor:pointer;font-family:inherit}.lang-select option{color:#333;background:#fff}
        main{flex:1;max-width:900px;width:100%;margin:0 auto;padding:32px 16px}
        .page-title{text-align:center;font-size:1.7rem;font-weight:700;margin-bottom:24px;color:var(--primary-dark)}
        .info-box{background:var(--primary-light);border-left:4px solid var(--primary);border-radius:0 var(--radius) var(--radius) 0;padding:16px 20px;margin-bottom:28px;display:flex;gap:12px;align-items:flex-start;font-size:.92rem;color:var(--primary-dark);line-height:1.6}.info-box .icon{font-size:1.2rem;flex-shrink:0;margin-top:2px}

        /* Converter Card */
        .converter-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px 24px;margin-bottom:20px}
        .converter-row{display:flex;gap:12px;align-items:stretch}
        .conv-side{flex:1;min-width:0}
        .conv-side label{font-weight:500;font-size:.9rem;margin-bottom:8px;display:flex;align-items:center;gap:6px}
        .currency-selector{position:relative;margin-bottom:10px}
        .currency-btn{width:100%;padding:12px 14px;border:2px solid var(--border);border-radius:10px;background:#fff;font-size:1rem;font-family:inherit;cursor:pointer;display:flex;align-items:center;gap:10px;transition:border-color .2s}
        .currency-btn:hover,.currency-btn.open{border-color:var(--primary)}
        .currency-btn .c-flag{font-size:1.3rem;flex-shrink:0}
        .currency-btn .c-code{font-weight:700;font-size:1rem}
        .currency-btn .c-name{color:var(--text-light);font-size:.82rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .currency-btn .c-arrow{margin-left:auto;transition:transform .2s;flex-shrink:0;color:var(--text-light)}
        .currency-btn.open .c-arrow{transform:rotate(180deg)}
        .currency-dd{position:absolute;top:calc(100% + 4px);left:0;right:0;background:#fff;border:1px solid var(--border);border-radius:10px;max-height:320px;overflow:hidden;box-shadow:var(--shadow);z-index:50;display:none;flex-direction:column}
        .currency-dd.show{display:flex}
        .currency-dd-search{padding:10px 12px;border-bottom:1px solid var(--border)}
        .currency-dd-search input{width:100%;padding:8px 12px;border:1.5px solid var(--border);border-radius:8px;font-size:.9rem;font-family:inherit;outline:none}
        .currency-dd-search input:focus{border-color:var(--primary)}
        .currency-dd-list{overflow-y:auto;flex:1}
        .cdd-group{padding:6px 14px 3px;font-size:.75rem;font-weight:600;color:var(--primary);background:#f8fafc;letter-spacing:.5px;position:sticky;top:0}
        .cdd-item{padding:10px 14px;cursor:pointer;display:flex;align-items:center;gap:10px;font-size:.92rem;transition:background .12s}
        .cdd-item:hover,.cdd-item.active{background:var(--primary-light)}
        .cdd-item .ci-flag{font-size:1.15rem}
        .cdd-item .ci-code{font-weight:600;min-width:36px}
        .cdd-item .ci-name{color:var(--text-light);font-size:.82rem}
        .amount-input{width:100%;padding:14px 16px;border:2px solid var(--border);border-radius:10px;font-size:1.5rem;font-family:inherit;font-weight:700;text-align:right;transition:border-color .2s,box-shadow .2s;color:var(--text)}
        .amount-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.12)}
        .amount-input.result{background:#f8fafc;color:var(--primary-dark);cursor:default}
        .swap-col{display:flex;align-items:center;justify-content:center;flex-shrink:0;padding-top:28px}
        .swap-btn{width:48px;height:48px;border-radius:50%;border:2px solid var(--border);background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.3rem;transition:all .25s;color:var(--primary)}
        .swap-btn:hover{background:var(--primary);color:#fff;border-color:var(--primary);transform:rotate(180deg);box-shadow:0 4px 16px rgba(37,99,235,.3)}

        /* Rate Display */
        .rate-display{text-align:center;margin-top:16px;padding:14px;background:linear-gradient(135deg,#f8fafc,#eff6ff);border-radius:10px;border:1px solid var(--border)}
        .rate-main{font-size:1.1rem;font-weight:600;color:var(--text);margin-bottom:4px;font-variant-numeric:tabular-nums}
        .rate-reverse{font-size:.88rem;color:var(--text-light);font-variant-numeric:tabular-nums}
        .rate-note{font-size:.78rem;color:var(--text-light);margin-top:6px}

        /* Quick Select */
        .quick-section{margin-bottom:20px}
        .quick-section h3{font-size:.95rem;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:8px}
        .quick-chips{display:flex;flex-wrap:wrap;gap:8px}
        .quick-chip{padding:7px 14px;border-radius:20px;border:1.5px solid var(--border);background:#fff;font-size:.85rem;cursor:pointer;font-family:inherit;transition:all .15s;display:flex;align-items:center;gap:6px}
        .quick-chip:hover{border-color:var(--primary);background:var(--primary-light);color:var(--primary-dark)}
        .quick-chip.active{border-color:var(--primary);background:var(--primary);color:#fff}

        /* Popular Rates */
        .section-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow-sm);border:1px solid var(--border);padding:22px 20px;margin-bottom:20px}
        .section-card h3{font-size:1rem;font-weight:600;margin-bottom:16px;display:flex;align-items:center;gap:8px;color:var(--text)}
        .rate-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}
        .rate-tile{border:1px solid var(--border);border-radius:10px;padding:14px;display:flex;align-items:center;gap:10px;transition:border-color .15s,box-shadow .15s;cursor:pointer}
        .rate-tile:hover{border-color:var(--primary);box-shadow:var(--shadow-sm)}
        .rate-tile .rt-flag{font-size:1.4rem}
        .rate-tile .rt-info{flex:1;min-width:0}
        .rate-tile .rt-code{font-weight:700;font-size:.95rem}
        .rate-tile .rt-name{font-size:.78rem;color:var(--text-light)}
        .rate-tile .rt-rate{font-weight:700;font-size:1rem;text-align:right;font-variant-numeric:tabular-nums;color:var(--primary-dark)}

        /* Keypad for mobile */
        .mobile-hint{display:none;text-align:center;color:var(--text-light);font-size:.82rem;margin-top:8px}

        .calc-note{font-size:.82rem;color:var(--text-light);line-height:1.6;padding:12px 16px;background:#f8fafc;border-radius:8px;margin-top:8px}

        footer{background:#1e293b;color:rgba(255,255,255,.7);padding:36px 24px 20px;margin-top:auto}
        .footer-grid{max-width:900px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:28px;margin-bottom:28px}
        .footer-col h4{color:#fff;font-size:.95rem;margin-bottom:12px;display:flex;align-items:center;gap:6px}
        .footer-col a{display:block;color:rgba(255,255,255,.6);text-decoration:none;font-size:.88rem;padding:4px 0;transition:color .2s}.footer-col a:hover{color:#fff}
        .footer-col a.active-link{color:var(--accent);font-weight:500}
        .footer-bottom{text-align:center;border-top:1px solid rgba(255,255,255,.1);padding-top:16px;font-size:.82rem}.footer-bottom a{color:rgba(255,255,255,.5);text-decoration:none}.footer-bottom a:hover{color:#fff}

        @media(max-width:640px){
            .page-title{font-size:1.3rem}
            .converter-row{flex-direction:column}
            .swap-col{padding-top:0;padding-bottom:0}.swap-btn{transform:rotate(90deg)}.swap-btn:hover{transform:rotate(270deg)}
            .amount-input{font-size:1.25rem}
            .rate-grid{grid-template-columns:1fr 1fr}
            .header-right a.contact-link{display:none}
            .mobile-hint{display:block}
        }
    </style>
</head>
<body>

<header>
    <div class="logo">
        <img src="logo.png" alt="Roamwise Logo" class="logo-img">
        Roam<span>wise</span>
    </div>
    <div class="logo">Roam<span>wise</span></div>
    <div class="header-right">
        <a href="#" class="contact-link">Cont√°ctenos</a>
        <select class="lang-select" id="langSelect">
                <option value="currency-zh.html">ÁπÅÈ´î‰∏≠Êñá</option>
                <option value="currency-en.html">English</option>
                <option value="currency-es.html" selected="">Espa√±ol</option>
                <option value="currency-pt.html" >Portugu√™s</option>
        </select>
    </div>
</header>
    
<script>
    function changeLanguage(filename) {
        window.location.href = filename;
    }
</script>

<main>
    <h1 class="page-title">üí± Conversor de Divisas</h1>
    <div class="info-box"><span class="icon">‚ÑπÔ∏è</span><div>Introduzca un importe para obtener la conversi√≥n en tiempo real. Compatible con m√°s de 40 divisas principales de todo el mundo. Los tipos de cambio son precios medios de referencia; las tasas reales pueden variar seg√∫n el banco o el m√©todo de transferencia.</div></div>

    <!-- Converter -->
    <div class="converter-card">
        <div class="converter-row">
            <div class="conv-side">
                <label>üí∞ De</label>
                <div class="currency-selector" id="fromSelector">
                    <button class="currency-btn" id="fromBtn"><span class="c-flag" id="fromFlag">üá∫üá∏</span><span class="c-code" id="fromCode">USD</span><span class="c-name" id="fromName">D√≥lar estadounidense</span><span class="c-arrow">‚ñæ</span></button>
                    <div class="currency-dd" id="fromDD">
                        <div class="currency-dd-search"><input type="text" placeholder="Buscar divisa‚Ä¶" id="fromSearch"></div>
                        <div class="currency-dd-list" id="fromList"></div>
                    </div>
                </div>
                <input type="text" inputmode="decimal" class="amount-input" id="fromAmount" value="1" placeholder="Introducir importe">
            </div>
            <div class="swap-col"><button class="swap-btn" id="swapBtn" title="Intercambiar">‚áÑ</button></div>
            <div class="conv-side">
                <label>üí∞ Convertir a</label>
                <div class="currency-selector" id="toSelector">
                    <button class="currency-btn" id="toBtn"><span class="c-flag" id="toFlag">üáπüáº</span><span class="c-code" id="toCode">TWD</span><span class="c-name" id="toName">Nuevo d√≥lar taiwan√©s</span><span class="c-arrow">‚ñæ</span></button>
                    <div class="currency-dd" id="toDD">
                        <div class="currency-dd-search"><input type="text" placeholder="Buscar divisa‚Ä¶" id="toSearch"></div>
                        <div class="currency-dd-list" id="toList"></div>
                    </div>
                </div>
                <input type="text" class="amount-input result" id="toAmount" readonly="" placeholder="Resultado">
            </div>
        </div>
        <div class="rate-display">
            <div class="rate-main" id="rateMain"></div>
            <div class="rate-reverse" id="rateReverse"></div>
            <div class="rate-note">‚è± Tipo de cambio de referencia solo para viajes, no es una cotizaci√≥n en tiempo real</div>
        </div>
    </div>

    <!-- Quick Select -->
    <div class="section-card">
        <h3>‚ö° Selecci√≥n r√°pida de divisas</h3>
        <div class="quick-chips" id="quickChips"></div>
    </div>

    <!-- Popular Rates -->
    <div class="section-card">
        <h3 id="popularTitle">üìä Comparaci√≥n de divisas principales</h3>
        <div class="rate-grid" id="rateGrid"></div>
    </div>

    <!-- Tips -->
    <div class="section-card">
        <h3>üí° Consejos para cambiar dinero en viajes</h3>
        <div style="font-size:.92rem;line-height:1.8;color:var(--text)">
            <p style="margin-bottom:10px">üè¶ <strong>Banco</strong>: Generalmente ofrece mejores tipos de cambio; recomendado para cambios de gran importe.</p>
            <p style="margin-bottom:10px">üèß <strong>Cajero autom√°tico</strong>: Retirar moneda local en un cajero autom√°tico en el extranjero suele ofrecer tipos cercanos al precio medio, pero tenga en cuenta las comisiones.</p>
            <p style="margin-bottom:10px">üí≥ <strong>Tarjeta de cr√©dito</strong>: Las comisiones por transacciones internacionales son normalmente del 1,5 %; algunos bancos ofrecen devoluci√≥n de efectivo para compensarlas.</p>
            <p style="margin-bottom:10px">‚úàÔ∏è <strong>Cambio en el aeropuerto</strong>: Los tipos suelen ser desfavorables; cambie solo una peque√±a cantidad de emergencia.</p>
            <p>üîÑ <strong>Fluctuaci√≥n del tipo de cambio</strong>: Controle los tipos antes de salir y cambie en varias operaciones en momentos favorables para reducir el riesgo cambiario.</p>
        </div>
    </div>

    <div class="calc-note">‚ö†Ô∏è Los tipos de cambio de este sitio son precios medios de referencia solo para planificaci√≥n de viajes. Las tasas reales dependen de los precios de compra/venta del banco, comisiones, canales de cambio y el momento de la operaci√≥n. Consulte con su banco antes de realizar cambios de gran importe.</div>
</main>

<footer>
    <div class="footer-grid">
        <div class="footer-col">
            <h4>üîå Electricidad y Hora</h4>
            <a href="plug/plug-es.html">B√∫squeda de Especificaciones de Enchufe</a>
            <a href="time-zone/time-zone-es.html" class="active-link">B√∫squeda de Zona Horaria</a>
            <a href="timer/timer-es.html" class="active-link">Temporizador y Cuenta Atr√°s</a>
            <a href="sunset/sunset-es.html">Horarios de Amanecer y Atardecer</a>
        </div>
        <div class="footer-col">
            <h4>üéâ Festivos y Festivales</h4>
            <a href="#">D√≠as Festivos por Pa√≠s</a>
            <a href="#">Resumen de Eventos Festivos</a>
        </div>
        <div class="footer-col">
            <h4>üí± Finanzas y Unidades</h4>
            <a href="currency/currency-es.html">Conversi√≥n de Divisas</a>
            <a href="unit/unit-es.html">Conversi√≥n de Unidades</a>
        </div>
        <div class="footer-col">
            <h4>üåç Informaci√≥n de Viaje</h4>
            <a href="#">Resumen por Pa√≠s</a>
            <a href="#">Gu√≠as Locales Detalladas</a>
        </div>
    </div>
    <div class="footer-bottom">¬© 2026 Roamwise. Todos los derechos reservados. | <a href="#">Pol√≠tica de Privacidad</a> | <a href="#">T√©rminos de Uso</a></div>
</footer>

<script>
// ============ CURRENCY DATA ============
// [code, flag, esName, group, rateToUSD]  (1 USD = ? units of this currency)
const currencies=[
// Populares
["USD","üá∫üá∏","D√≥lar estadounidense","Populares",1],
["EUR","üá™üá∫","Euro","Populares",0.921],
["GBP","üá¨üáß","Libra esterlina","Populares",0.789],
["JPY","üáØüáµ","Yen japon√©s","Populares",149.2],
["CNY","üá®üá≥","Yuan chino","Populares",7.25],
["TWD","üáπüáº","Nuevo d√≥lar taiwan√©s","Populares",32.45],
["KRW","üá∞üá∑","Won surcoreano","Populares",1348],
["HKD","üá≠üá∞","D√≥lar de Hong Kong","Populares",7.82],
// Asia-Pac√≠fico
["SGD","üá∏üá¨","D√≥lar de Singapur","Asia-Pac√≠fico",1.342],
["MYR","üá≤üáæ","Ringgit malayo","Asia-Pac√≠fico",4.72],
["THB","üáπüá≠","Baht tailand√©s","Asia-Pac√≠fico",35.5],
["PHP","üáµüá≠","Peso filipino","Asia-Pac√≠fico",57.5],
["IDR","üáÆüá©","Rupia indonesia","Asia-Pac√≠fico",16200],
["VND","üáªüá≥","Dong vietnamita","Asia-Pac√≠fico",25300],
["INR","üáÆüá≥","Rupia india","Asia-Pac√≠fico",84.5],
["PKR","üáµüá∞","Rupia pakistan√≠","Asia-Pac√≠fico",278],
["BDT","üáßüá©","Taka banglades√≠","Asia-Pac√≠fico",121],
["LKR","üá±üá∞","Rupia de Sri Lanka","Asia-Pac√≠fico",325],
["NPR","üá≥üáµ","Rupia nepalesa","Asia-Pac√≠fico",135],
["KHR","üá∞üá≠","Riel camboyano","Asia-Pac√≠fico",4100],
["MMK","üá≤üá≤","Kyat birmano","Asia-Pac√≠fico",2100],
["MOP","üá≤üá¥","Pataca macaense","Asia-Pac√≠fico",8.06],
["AUD","üá¶üá∫","D√≥lar australiano","Asia-Pac√≠fico",1.58],
["NZD","üá≥üáø","D√≥lar neozeland√©s","Asia-Pac√≠fico",1.73],
["FJD","üá´üáØ","D√≥lar fiyiano","Asia-Pac√≠fico",2.28],
// Europa
["CHF","üá®üá≠","Franco suizo","Europa",0.882],
["SEK","üá∏üá™","Corona sueca","Europa",10.8],
["NOK","üá≥üá¥","Corona noruega","Europa",10.92],
["DKK","üá©üá∞","Corona danesa","Europa",6.87],
["PLN","üáµüá±","Esloti polaco","Europa",4.05],
["CZK","üá®üáø","Corona checa","Europa",23.5],
["HUF","üá≠üá∫","Forinto h√∫ngaro","Europa",380],
["ISK","üáÆüá∏","Corona islandesa","Europa",137],
["RUB","üá∑üá∫","Rublo ruso","Europa",96],
["UAH","üá∫üá¶","Grivna ucraniana","Europa",41.5],
["TRY","üáπüá∑","Lira turca","Europa",35.2],
// Oriente Medio
["AED","üá¶üá™","D√≠rham de los EAU","Oriente Medio",3.673],
["SAR","üá∏üá¶","Riyal saud√≠","Oriente Medio",3.75],
["QAR","üá∂üá¶","Riyal catar√≠","Oriente Medio",3.64],
["ILS","üáÆüá±","S√©quel israel√≠","Oriente Medio",3.62],
["JOD","üáØüá¥","Dinar jordano","Oriente Medio",0.709],
["MVR","üá≤üáª","Rufiyaa maldiva","Oriente Medio",15.42],
// Am√©ricas
["CAD","üá®üá¶","D√≥lar canadiense","Am√©ricas",1.38],
["MXN","üá≤üáΩ","Peso mexicano","Am√©ricas",17.5],
["BRL","üáßüá∑","Real brasile√±o","Am√©ricas",5.82],
["ARS","üá¶üá∑","Peso argentino","Am√©ricas",1050],
["CLP","üá®üá±","Peso chileno","Am√©ricas",980],
["COP","üá®üá¥","Peso colombiano","Am√©ricas",4150],
["PEN","üáµüá™","Sol peruano","Am√©ricas",3.72],
["UYU","üá∫üáæ","Peso uruguayo","Am√©ricas",42.5],
["CRC","üá®üá∑","Col√≥n costarricense","Am√©ricas",510],
// √Åfrica
["EGP","üá™üá¨","Libra egipcia","√Åfrica",50.5],
["ZAR","üáøüá¶","Rand sudafricano","√Åfrica",18.5],
["KES","üá∞üá™","Chel√≠n keniano","√Åfrica",153],
["MAD","üá≤üá¶","D√≠rham marroqu√≠","√Åfrica",10.05],
["NGN","üá≥üá¨","Naira nigeriana","√Åfrica",1550],
["TZS","üáπüáø","Chel√≠n tanzano","√Åfrica",2650],
["GHS","üá¨üá≠","Cedi ghan√©s","√Åfrica",15.8],
["ETB","üá™üáπ","Birr et√≠ope","√Åfrica",125]
];

const groupOrder=["Populares","Asia-Pac√≠fico","Europa","Oriente Medio","Am√©ricas","√Åfrica"];
const cMap={};currencies.forEach(c=>{cMap[c[0]]={code:c[0],flag:c[1],name:c[2],group:c[3],rate:c[4]}});

const quickList=["TWD","JPY","EUR","GBP","CNY","KRW","HKD","THB","AUD","SGD","CAD","CHF"];

// ============ STATE ============
let fromCur="USD",toCur="TWD",lastEdited="from";

// ============ DROPDOWN ============
function buildDropdown(listEl,searchEl,side){
    function render(q){
        q=(q||'').trim().toLowerCase();
        listEl.innerHTML='';
        const grouped={};groupOrder.forEach(g=>grouped[g]=[]);
        currencies.forEach(c=>{
            const code=c[0].toLowerCase(),name=c[2],flag=c[1];
            if(q&&!code.includes(q)&&!name.toLowerCase().includes(q))return;
            if(grouped[c[3]])grouped[c[3]].push(c);
        });
        let n=0;
        groupOrder.forEach(g=>{
            if(!grouped[g]||!grouped[g].length)return;
            const hdr=document.createElement('div');hdr.className='cdd-group';hdr.textContent=g;listEl.appendChild(hdr);
            grouped[g].forEach(c=>{
                const it=document.createElement('div');it.className='cdd-item';
                const sel=side==='from'?fromCur:toCur;
                if(c[0]===sel)it.classList.add('active');
                it.innerHTML='<span class="ci-flag">'+c[1]+'</span><span class="ci-code">'+c[0]+'</span><span class="ci-name">'+c[2]+'</span>';
                it.addEventListener('mousedown',e=>{
                    e.preventDefault();
                    if(side==='from'){fromCur=c[0];updateFromBtn()}else{toCur=c[0];updateToBtn()}
                    closeAll();convert();updatePopular();updateQuickChips();
                });
                listEl.appendChild(it);n++;
            });
        });
        if(!n){const d=document.createElement('div');d.className='cdd-item';d.textContent='No se encontr√≥ ninguna divisa';d.style.color='#94a3b8';listEl.appendChild(d)}
    }
    searchEl.addEventListener('input',()=>render(searchEl.value));
    return render;
}

const renderFromDD=buildDropdown(document.getElementById('fromList'),document.getElementById('fromSearch'),'from');
const renderToDD=buildDropdown(document.getElementById('toList'),document.getElementById('toSearch'),'to');

// Open/close
function closeAll(){
    document.querySelectorAll('.currency-dd').forEach(d=>d.classList.remove('show'));
    document.querySelectorAll('.currency-btn').forEach(b=>b.classList.remove('open'));
}

['from','to'].forEach(side=>{
    const btn=document.getElementById(side+'Btn');
    const dd=document.getElementById(side+'DD');
    const search=document.getElementById(side+'Search');
    btn.addEventListener('click',e=>{
        e.stopPropagation();
        const wasOpen=dd.classList.contains('show');
        closeAll();
        if(!wasOpen){
            dd.classList.add('show');btn.classList.add('open');
            search.value='';
            (side==='from'?renderFromDD:renderToDD)('');
            setTimeout(()=>search.focus(),50);
        }
    });
});
document.addEventListener('click',()=>closeAll());
document.querySelectorAll('.currency-dd').forEach(d=>d.addEventListener('click',e=>e.stopPropagation()));

// ============ UPDATE BUTTONS ============
function updateFromBtn(){
    const c=cMap[fromCur];
    document.getElementById('fromFlag').textContent=c.flag;
    document.getElementById('fromCode').textContent=c.code;
    document.getElementById('fromName').textContent=c.name;
}
function updateToBtn(){
    const c=cMap[toCur];
    document.getElementById('toFlag').textContent=c.flag;
    document.getElementById('toCode').textContent=c.code;
    document.getElementById('toName').textContent=c.name;
}

// ============ CONVERSION ============
function getRate(from,to){
    return cMap[to].rate/cMap[from].rate;
}
function fmtNum(n,decimals){
    if(n>=1000)decimals=Math.min(decimals,2);
    if(n>=100)decimals=Math.min(decimals,2);
    return n.toLocaleString('zh-TW',{minimumFractionDigits:decimals,maximumFractionDigits:decimals});
}
function smartDecimals(rate){
    if(rate>=1000)return 2;
    if(rate>=100)return 2;
    if(rate>=10)return 3;
    if(rate>=1)return 4;
    if(rate>=0.01)return 5;
    return 6;
}

function convert(){
    const fromInput=document.getElementById('fromAmount');
    const toInput=document.getElementById('toAmount');
    const rate=getRate(fromCur,toCur);
    const reverseRate=getRate(toCur,fromCur);

    if(lastEdited==='from'){
        const val=parseFloat(fromInput.value.replace(/,/g,''));
        if(isNaN(val)||fromInput.value.trim()===''){
            toInput.value='';
        }else{
            const result=val*rate;
            toInput.value=fmtNum(result,smartDecimals(result));
        }
    }else{
        const val=parseFloat(toInput.value.replace(/,/g,''));
        if(isNaN(val)||toInput.value.trim()===''){
            fromInput.value='';
        }else{
            const result=val*reverseRate;
            fromInput.value=fmtNum(result,smartDecimals(result));
        }
    }

    // Rate display
    const cf=cMap[fromCur],ct=cMap[toCur];
    const dec=smartDecimals(rate);
    const rdec=smartDecimals(reverseRate);
    document.getElementById('rateMain').textContent='1 '+cf.code+' '+cf.flag+' = '+fmtNum(rate,dec)+' '+ct.code+' '+ct.flag;
    document.getElementById('rateReverse').textContent='1 '+ct.code+' '+ct.flag+' = '+fmtNum(reverseRate,rdec)+' '+cf.code+' '+cf.flag;
}

// Input handling
const fromInput=document.getElementById('fromAmount');
const toInput=document.getElementById('toAmount');

fromInput.addEventListener('input',()=>{
    lastEdited='from';
    // Clean non-numeric chars except dot
    let v=fromInput.value.replace(/[^0-9.]/g,'');
    const parts=v.split('.');if(parts.length>2)v=parts[0]+'.'+parts.slice(1).join('');
    fromInput.value=v;
    convert();
});
fromInput.addEventListener('focus',()=>{lastEdited='from';fromInput.select()});

// Make toAmount editable too for bidirectional
toInput.removeAttribute('readonly');
toInput.addEventListener('input',()=>{
    lastEdited='to';
    let v=toInput.value.replace(/[^0-9.]/g,'');
    const parts=v.split('.');if(parts.length>2)v=parts[0]+'.'+parts.slice(1).join('');
    toInput.value=v;
    convert();
});
toInput.addEventListener('focus',()=>{lastEdited='to';toInput.select()});

// Swap
document.getElementById('swapBtn').addEventListener('click',()=>{
    const tmp=fromCur;fromCur=toCur;toCur=tmp;
    updateFromBtn();updateToBtn();
    // Also swap values
    const tmpVal=fromInput.value;fromInput.value=toInput.value;toInput.value=tmpVal;
    lastEdited='from';
    convert();updatePopular();updateQuickChips();
});

// ============ QUICK CHIPS ============
function updateQuickChips(){
    const container=document.getElementById('quickChips');
    container.innerHTML='';
    quickList.forEach(code=>{
        const c=cMap[code];if(!c)return;
        const chip=document.createElement('button');
        chip.className='quick-chip';
        if(code===fromCur||code===toCur)chip.classList.add('active');
        chip.innerHTML=c.flag+' '+c.code;
        chip.addEventListener('click',()=>{
            // If same as from, swap
            if(code===fromCur){
                // set as toCur
                toCur=code;updateToBtn();
            }else{
                toCur=code;updateToBtn();
            }
            lastEdited='from';
            convert();updatePopular();updateQuickChips();
        });
        container.appendChild(chip);
    });
}

// ============ POPULAR RATES TABLE ============
const popularCodes=["USD","EUR","GBP","JPY","CNY","KRW","HKD","THB","AUD","SGD","CAD","CHF"];
function updatePopular(){
    const grid=document.getElementById('rateGrid');
    grid.innerHTML='';
    const base=fromCur;
    const cf=cMap[base];
    document.getElementById('popularTitle').innerHTML='üìä 1 '+cf.flag+' '+cf.code+' equivale a‚Ä¶';
    popularCodes.forEach(code=>{
        if(code===base)return;
        const c=cMap[code];if(!c)return;
        const rate=getRate(base,code);
        const tile=document.createElement('div');tile.className='rate-tile';
        tile.innerHTML='<span class="rt-flag">'+c.flag+'</span><div class="rt-info"><div class="rt-code">'+c.code+'</div><div class="rt-name">'+c.name+'</div></div><div class="rt-rate">'+fmtNum(rate,smartDecimals(rate))+'</div>';
        tile.addEventListener('click',()=>{
            toCur=code;updateToBtn();lastEdited='from';convert();updatePopular();updateQuickChips();
            document.querySelector('.converter-card').scrollIntoView({behavior:'smooth',block:'start'});
        });
        grid.appendChild(tile);
    });
}

// ============ INIT ============
updateFromBtn();updateToBtn();convert();updateQuickChips();updatePopular();
</script>


</body></html>
