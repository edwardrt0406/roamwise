<!DOCTYPE html><html lang="zh-Hant"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roamwise - Currency Exchange</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&amp;display=swap" rel="stylesheet">
    <style>
        :root{--primary:#2563eb;--primary-dark:#1d4ed8;--primary-light:#dbeafe;--accent:#f59e0b;--bg:#f0f4f8;--card:#fff;--text:#1e293b;--text-light:#64748b;--border:#e2e8f0;--radius:12px;--shadow:0 4px 24px rgba(0,0,0,.07);--shadow-sm:0 2px 8px rgba(0,0,0,.05);--green:#10b981;--red:#ef4444}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans TC',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column}
                
        header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: #fff; padding: 0 24px; height: 60px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 12px rgba(37,99,235,0.3); }
        .logo { font-size: 1.4rem; font-weight: 700; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        .logo span { color: var(--accent); }
        .header-right { display: flex; align-items: center; gap: 16px; }
        .header-right a { color: rgba(255,255,255,0.85); text-decoration: none; font-size: 0.9rem; transition: color 0.2s; }
        .header-right a:hover { color: #fff; }
        .lang-select { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 6px 12px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; font-family: inherit; }
        .lang-select option { color: #333; background: #fff; }
        
        main{flex:1;max-width:900px;width:100%;margin:0 auto;padding:32px 16px}
        .page-title{text-align:center;font-size:1.7rem;font-weight:700;margin-bottom:24px;color:var(--primary-dark)}
        
        .info-box{background:var(--primary-light);border-left:4px solid var(--primary);border-radius:0 var(--radius) var(--radius) 0;padding:16px 20px;margin-bottom:28px;display:flex;gap:12px;align-items:flex-start;font-size:.92rem;color:var(--primary-dark);line-height:1.6}.info-box .icon{font-size:1.2rem;flex-shrink:0;margin-top:2px}

        /* Converter Card */
        .converter-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px 24px;margin-bottom:20px}
        .converter-row{display:flex;gap:12px;align-items:stretch}
        .conv-side{flex:1;min-width:0}
        .conv-side label{font-weight:500;font-size:.9rem;margin-bottom:8px;display:flex;align-items:center;gap:6px}
        .currency-selector{position:relative;margin-bottom:10px}
        .currency-btn{width:100%;padding:12px 14px;border:2px solid var(--border);border-radius:10px;background:#fff;font-size:1rem;font-family:inherit;cursor:pointer;display:flex;align-items:center;gap:10px;transition:border-color .2s}
        .currency-btn:hover,.currency-btn.open{border-color:var(--primary)}
        .currency-btn .c-flag{font-size:1.3rem;flex-shrink:0}
        .currency-btn .c-code{font-weight:700;font-size:1rem}
        .currency-btn .c-name{color:var(--text-light);font-size:.82rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .currency-btn .c-arrow{margin-left:auto;transition:transform .2s;flex-shrink:0;color:var(--text-light)}
        .currency-btn.open .c-arrow{transform:rotate(180deg)}
        .currency-dd{position:absolute;top:calc(100% + 4px);left:0;right:0;background:#fff;border:1px solid var(--border);border-radius:10px;max-height:320px;overflow:hidden;box-shadow:var(--shadow);z-index:50;display:none;flex-direction:column}
        .currency-dd.show{display:flex}
        .currency-dd-search{padding:10px 12px;border-bottom:1px solid var(--border)}
        .currency-dd-search input{width:100%;padding:8px 12px;border:1.5px solid var(--border);border-radius:8px;font-size:.9rem;font-family:inherit;outline:none}
        .currency-dd-search input:focus{border-color:var(--primary)}
        .currency-dd-list{overflow-y:auto;flex:1}
        .cdd-group{padding:6px 14px 3px;font-size:.75rem;font-weight:600;color:var(--primary);background:#f8fafc;letter-spacing:.5px;position:sticky;top:0}
        .cdd-item{padding:10px 14px;cursor:pointer;display:flex;align-items:center;gap:10px;font-size:.92rem;transition:background .12s}
        .cdd-item:hover,.cdd-item.active{background:var(--primary-light)}
        .cdd-item .ci-flag{font-size:1.15rem}
        .cdd-item .ci-code{font-weight:600;min-width:36px}
        .cdd-item .ci-name{color:var(--text-light);font-size:.82rem}
        .amount-input{width:100%;padding:14px 16px;border:2px solid var(--border);border-radius:10px;font-size:1.5rem;font-family:inherit;font-weight:700;text-align:right;transition:border-color .2s,box-shadow .2s;color:var(--text)}
        .amount-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.12)}
        .amount-input.result{background:#f8fafc;color:var(--primary-dark);cursor:default}
        .swap-col{display:flex;align-items:center;justify-content:center;flex-shrink:0;padding-top:28px}
        .swap-btn{width:48px;height:48px;border-radius:50%;border:2px solid var(--border);background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.3rem;transition:all .25s;color:var(--primary)}
        .swap-btn:hover{background:var(--primary);color:#fff;border-color:var(--primary);transform:rotate(180deg);box-shadow:0 4px 16px rgba(37,99,235,.3)}

        /* Rate Display */
        .rate-display{text-align:center;margin-top:16px;padding:14px;background:linear-gradient(135deg,#f8fafc,#eff6ff);border-radius:10px;border:1px solid var(--border)}
        .rate-main{font-size:1.1rem;font-weight:600;color:var(--text);margin-bottom:4px;font-variant-numeric:tabular-nums}
        .rate-reverse{font-size:.88rem;color:var(--text-light);font-variant-numeric:tabular-nums}
        .rate-note{font-size:.78rem;color:var(--text-light);margin-top:6px}

        /* Quick Select */
        .quick-section{margin-bottom:20px}
        .quick-section h3{font-size:.95rem;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:8px}
        .quick-chips{display:flex;flex-wrap:wrap;gap:8px}
        .quick-chip{padding:7px 14px;border-radius:20px;border:1.5px solid var(--border);background:#fff;font-size:.85rem;cursor:pointer;font-family:inherit;transition:all .15s;display:flex;align-items:center;gap:6px}
        .quick-chip:hover{border-color:var(--primary);background:var(--primary-light);color:var(--primary-dark)}
        .quick-chip.active{border-color:var(--primary);background:var(--primary);color:#fff}

        /* Popular Rates */
        .section-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow-sm);border:1px solid var(--border);padding:22px 20px;margin-bottom:20px}
        .section-card h3{font-size:1rem;font-weight:600;margin-bottom:16px;display:flex;align-items:center;gap:8px;color:var(--text)}
        .rate-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}
        .rate-tile{border:1px solid var(--border);border-radius:10px;padding:14px;display:flex;align-items:center;gap:10px;transition:border-color .15s,box-shadow .15s;cursor:pointer}
        .rate-tile:hover{border-color:var(--primary);box-shadow:var(--shadow-sm)}
        .rate-tile .rt-flag{font-size:1.4rem}
        .rate-tile .rt-info{flex:1;min-width:0}
        .rate-tile .rt-code{font-weight:700;font-size:.95rem}
        .rate-tile .rt-name{font-size:.78rem;color:var(--text-light)}
        .rate-tile .rt-rate{font-weight:700;font-size:1rem;text-align:right;font-variant-numeric:tabular-nums;color:var(--primary-dark)}

        /* Keypad for mobile */
        .mobile-hint{display:none;text-align:center;color:var(--text-light);font-size:.82rem;margin-top:8px}

        .calc-note{font-size:.82rem;color:var(--text-light);line-height:1.6;padding:12px 16px;background:#f8fafc;border-radius:8px;margin-top:8px}

        footer{background:#1e293b;color:rgba(255,255,255,.7);padding:36px 24px 20px;margin-top:auto}
        .footer-grid{max-width:900px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:28px;margin-bottom:28px}
        .footer-col h4{color:#fff;font-size:.95rem;margin-bottom:12px;display:flex;align-items:center;gap:6px}
        .footer-col a{display:block;color:rgba(255,255,255,.6);text-decoration:none;font-size:.88rem;padding:4px 0;transition:color .2s}.footer-col a:hover{color:#fff}
        .footer-col a.active-link{color:var(--accent);font-weight:500}
        .footer-bottom{text-align:center;border-top:1px solid rgba(255,255,255,.1);padding-top:16px;font-size:.82rem}.footer-bottom a{color:rgba(255,255,255,.5);text-decoration:none}.footer-bottom a:hover{color:#fff}

        @media(max-width:640px){
            .page-title{font-size:1.3rem}
            .converter-row{flex-direction:column}
            .swap-col{padding-top:0;padding-bottom:0}.swap-btn{transform:rotate(90deg)}.swap-btn:hover{transform:rotate(270deg)}
            .amount-input{font-size:1.25rem}
            .rate-grid{grid-template-columns:1fr 1fr}
            .header-right a.contact-link{display:none}
            .mobile-hint{display:block}
        }
    </style>
</head>
<body>

<header>
<header>
    <div class="logo">
        <img src="logo.png" alt="Roamwise Logo" class="logo-img">
        Roam<span>wise</span>
    </div>
    <div class="header-right">
        <a href="#" class="contact-link">contact us</a>
        <select class="lang-select" onchange="changeLanguage(this.value)">
            <option value="currency-zh.html" >ç¹é«”ä¸­æ–‡</option>
            <option value="currency-en.html" selected="">English</option>
            <option value="currency-es.html">EspaÃ±ol</option>
            <option value="currency-pt.html">PortuguÃªs</option>
        </select>
    </div>
</header>

<script>
    function changeLanguage(filename) {
        window.location.href = filename;
    }
</script>

<main>
    <h1 class="page-title">ğŸ’± Currency Exchange</h1>
    <div class="info-box"><span class="icon">â„¹ï¸</span><div>Enter an amount for real-time conversion. Supports 40+ major currencies worldwide. Exchange rates are indicative mid-market rates; actual transaction rates may vary by bank or transfer method.</div></div>

    <!-- Converter -->
    <div class="converter-card">
        <div class="converter-row">
            <div class="conv-side">
                <label>ğŸ’° From</label>
                <div class="currency-selector" id="fromSelector">
                    <button class="currency-btn" id="fromBtn"><span class="c-flag" id="fromFlag">ğŸ‡ºğŸ‡¸</span><span class="c-code" id="fromCode">USD</span><span class="c-name" id="fromName">US Dollar</span><span class="c-arrow">â–¾</span></button>
                    <div class="currency-dd" id="fromDD">
                        <div class="currency-dd-search"><input type="text" placeholder="Search currencyâ€¦" id="fromSearch"></div>
                        <div class="currency-dd-list" id="fromList"></div>
                    </div>
                </div>
                <input type="text" inputmode="decimal" class="amount-input" id="fromAmount" value="1" placeholder="Enter amount">
            </div>
            <div class="swap-col"><button class="swap-btn" id="swapBtn" title="Swap">â‡„</button></div>
            <div class="conv-side">
                <label>ğŸ’° Convert To</label>
                <div class="currency-selector" id="toSelector">
                    <button class="currency-btn" id="toBtn"><span class="c-flag" id="toFlag">ğŸ‡¹ğŸ‡¼</span><span class="c-code" id="toCode">TWD</span><span class="c-name" id="toName">New Taiwan Dollar</span><span class="c-arrow">â–¾</span></button>
                    <div class="currency-dd" id="toDD">
                        <div class="currency-dd-search"><input type="text" placeholder="Search currencyâ€¦" id="toSearch"></div>
                        <div class="currency-dd-list" id="toList"></div>
                    </div>
                </div>
                <input type="text" class="amount-input result" id="toAmount" readonly="" placeholder="Result">
            </div>
        </div>
        <div class="rate-display">
            <div class="rate-main" id="rateMain"></div>
            <div class="rate-reverse" id="rateReverse"></div>
            <div class="rate-note">â± Reference exchange rate for travel purposes only, not a real-time trading quote</div>
        </div>
    </div>

    <!-- Quick Select -->
    <div class="section-card">
        <h3>âš¡ Quick Currency Select</h3>
        <div class="quick-chips" id="quickChips"></div>
    </div>

    <!-- Popular Rates -->
    <div class="section-card">
        <h3 id="popularTitle">ğŸ“Š Major Currency Comparison</h3>
        <div class="rate-grid" id="rateGrid"></div>
    </div>

    <!-- Tips -->
    <div class="section-card">
        <h3>ğŸ’¡ Travel Money Tips</h3>
        <div style="font-size:.92rem;line-height:1.8;color:var(--text)">
            <p style="margin-bottom:10px">ğŸ¦ <strong>Bank Counter</strong>: Usually offers better exchange rates; recommended for large exchanges.</p>
            <p style="margin-bottom:10px">ğŸ§ <strong>ATM Withdrawal</strong>: Withdrawing local currency from an overseas ATM typically gives rates close to the mid-market rate, but watch out for fees.</p>
            <p style="margin-bottom:10px">ğŸ’³ <strong>Credit Card</strong>: International transaction fees are typically around 1.5%; some banks offer cashback rewards to offset the cost.</p>
            <p style="margin-bottom:10px">âœˆï¸ <strong>Airport Exchange</strong>: Rates are usually unfavourable; exchange only a small emergency amount.</p>
            <p>ğŸ”„ <strong>Exchange Rate Fluctuation</strong>: Monitor rates before departure and exchange in batches at favourable times to reduce currency risk.</p>
        </div>
    </div>

    <div class="calc-note">âš ï¸ Exchange rates on this site are indicative mid-market rates for travel planning purposes only. Actual transaction rates depend on bank buy/sell prices, fees, exchange channels, and timing. Please consult your bank before making large exchanges.</div>
</main>

<footer>
<div class="footer-grid">
Â  Â  Â  Â  <div class="footer-col">
Â  Â  Â  Â  Â  Â  <h4>ğŸ”Œ Power &amp; Time</h4>
Â  Â  Â  Â  Â  Â  <a href="plug/plug-en.html">Plug Specification Lookup</a>
Â  Â  Â  Â  Â  Â  <a href="time-zone/time-zone-en.html" class="active-link">Time Zone Lookup</a>
            <a href="timer/timer-en.html" class="active-link">Timer</a>
Â  Â  Â  Â  Â  Â  <a href="sunset/sunset-en.html">Sunset &amp; Sunset Times</a>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="footer-col">
Â  Â  Â  Â  Â  Â  <h4>ğŸ‰ Holidays &amp; Festivals</h4>
Â  Â  Â  Â  Â  Â  <a href="#">Public Holidays by Country</a>
Â  Â  Â  Â  Â  Â  <a href="#">Festival Events Overview</a>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="footer-col">
Â  Â  Â  Â  Â  Â  <h4>ğŸ’± Finance &amp; Units</h4>
Â  Â  Â  Â  Â  Â  <a href="currency/currency-en.html">Currency Conversion</a>
Â  Â  Â  Â  Â  Â  <a href="unit/unit-en.html">Unit Conversion</a>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="footer-col">
Â  Â  Â  Â  Â  Â  <h4>ğŸŒ Travel Information</h4>
Â  Â  Â  Â  Â  Â  <a href="#">Country Overview</a>
Â  Â  Â  Â  Â  Â  <a href="#">Detailed Local Guides</a>
Â  Â  Â  Â  </div>
    <div class="ft-bot">Â© 2026 Roamwise. All rights reserved. | <a href="#">éš±ç§æ¬Šæ”¿ç­–</a> | <a href="#">ä½¿ç”¨æ¢æ¬¾</a></div>
</footer>

<script>
// ============ CURRENCY DATA ============
// [code, flag, enName, group, rateToUSD]  (1 USD = ? units of this currency)
const currencies=[
// Popular
["USD","ğŸ‡ºğŸ‡¸","US Dollar","Popular",1],
["EUR","ğŸ‡ªğŸ‡º","Euro","Popular",0.921],
["GBP","ğŸ‡¬ğŸ‡§","British Pound","Popular",0.789],
["JPY","ğŸ‡¯ğŸ‡µ","Japanese Yen","Popular",149.2],
["CNY","ğŸ‡¨ğŸ‡³","Chinese Yuan","Popular",7.25],
["TWD","ğŸ‡¹ğŸ‡¼","New Taiwan Dollar","Popular",32.45],
["KRW","ğŸ‡°ğŸ‡·","South Korean Won","Popular",1348],
["HKD","ğŸ‡­ğŸ‡°","Hong Kong Dollar","Popular",7.82],
// Asia-Pacific
["SGD","ğŸ‡¸ğŸ‡¬","Singapore Dollar","Asia-Pacific",1.342],
["MYR","ğŸ‡²ğŸ‡¾","Malaysian Ringgit","Asia-Pacific",4.72],
["THB","ğŸ‡¹ğŸ‡­","Thai Baht","Asia-Pacific",35.5],
["PHP","ğŸ‡µğŸ‡­","Philippine Peso","Asia-Pacific",57.5],
["IDR","ğŸ‡®ğŸ‡©","Indonesian Rupiah","Asia-Pacific",16200],
["VND","ğŸ‡»ğŸ‡³","Vietnamese Dong","Asia-Pacific",25300],
["INR","ğŸ‡®ğŸ‡³","Indian Rupee","Asia-Pacific",84.5],
["PKR","ğŸ‡µğŸ‡°","Pakistani Rupee","Asia-Pacific",278],
["BDT","ğŸ‡§ğŸ‡©","Bangladeshi Taka","Asia-Pacific",121],
["LKR","ğŸ‡±ğŸ‡°","Sri Lankan Rupee","Asia-Pacific",325],
["NPR","ğŸ‡³ğŸ‡µ","Nepalese Rupee","Asia-Pacific",135],
["KHR","ğŸ‡°ğŸ‡­","Cambodian Riel","Asia-Pacific",4100],
["MMK","ğŸ‡²ğŸ‡²","Myanmar Kyat","Asia-Pacific",2100],
["MOP","ğŸ‡²ğŸ‡´","Macanese Pataca","Asia-Pacific",8.06],
["AUD","ğŸ‡¦ğŸ‡º","Australian Dollar","Asia-Pacific",1.58],
["NZD","ğŸ‡³ğŸ‡¿","New Zealand Dollar","Asia-Pacific",1.73],
["FJD","ğŸ‡«ğŸ‡¯","Fijian Dollar","Asia-Pacific",2.28],
// Europe
["CHF","ğŸ‡¨ğŸ‡­","Swiss Franc","Europe",0.882],
["SEK","ğŸ‡¸ğŸ‡ª","Swedish Krona","Europe",10.8],
["NOK","ğŸ‡³ğŸ‡´","Norwegian Krone","Europe",10.92],
["DKK","ğŸ‡©ğŸ‡°","Danish Krone","Europe",6.87],
["PLN","ğŸ‡µğŸ‡±","Polish Zloty","Europe",4.05],
["CZK","ğŸ‡¨ğŸ‡¿","Czech Koruna","Europe",23.5],
["HUF","ğŸ‡­ğŸ‡º","Hungarian Forint","Europe",380],
["ISK","ğŸ‡®ğŸ‡¸","Icelandic Krona","Europe",137],
["RUB","ğŸ‡·ğŸ‡º","Russian Ruble","Europe",96],
["UAH","ğŸ‡ºğŸ‡¦","Ukrainian Hryvnia","Europe",41.5],
["TRY","ğŸ‡¹ğŸ‡·","Turkish Lira","Europe",35.2],
// Middle East
["AED","ğŸ‡¦ğŸ‡ª","UAE Dirham","Middle East",3.673],
["SAR","ğŸ‡¸ğŸ‡¦","Saudi Riyal","Middle East",3.75],
["QAR","ğŸ‡¶ğŸ‡¦","Qatari Riyal","Middle East",3.64],
["ILS","ğŸ‡®ğŸ‡±","Israeli Shekel","Middle East",3.62],
["JOD","ğŸ‡¯ğŸ‡´","Jordanian Dinar","Middle East",0.709],
["MVR","ğŸ‡²ğŸ‡»","Maldivian Rufiyaa","Middle East",15.42],
// Americas
["CAD","ğŸ‡¨ğŸ‡¦","Canadian Dollar","Americas",1.38],
["MXN","ğŸ‡²ğŸ‡½","Mexican Peso","Americas",17.5],
["BRL","ğŸ‡§ğŸ‡·","Brazilian Real","Americas",5.82],
["ARS","ğŸ‡¦ğŸ‡·","Argentine Peso","Americas",1050],
["CLP","ğŸ‡¨ğŸ‡±","Chilean Peso","Americas",980],
["COP","ğŸ‡¨ğŸ‡´","Colombian Peso","Americas",4150],
["PEN","ğŸ‡µğŸ‡ª","Peruvian Sol","Americas",3.72],
["UYU","ğŸ‡ºğŸ‡¾","Uruguayan Peso","Americas",42.5],
["CRC","ğŸ‡¨ğŸ‡·","Costa Rican ColÃ³n","Americas",510],
// Africa
["EGP","ğŸ‡ªğŸ‡¬","Egyptian Pound","Africa",50.5],
["ZAR","ğŸ‡¿ğŸ‡¦","South African Rand","Africa",18.5],
["KES","ğŸ‡°ğŸ‡ª","Kenyan Shilling","Africa",153],
["MAD","ğŸ‡²ğŸ‡¦","Moroccan Dirham","Africa",10.05],
["NGN","ğŸ‡³ğŸ‡¬","Nigerian Naira","Africa",1550],
["TZS","ğŸ‡¹ğŸ‡¿","Tanzanian Shilling","Africa",2650],
["GHS","ğŸ‡¬ğŸ‡­","Ghanaian Cedi","Africa",15.8],
["ETB","ğŸ‡ªğŸ‡¹","Ethiopian Birr","Africa",125]
];

const groupOrder=["Popular","Asia-Pacific","Europe","Middle East","Americas","Africa"];
const cMap={};currencies.forEach(c=>{cMap[c[0]]={code:c[0],flag:c[1],name:c[2],group:c[3],rate:c[4]}});

const quickList=["TWD","JPY","EUR","GBP","CNY","KRW","HKD","THB","AUD","SGD","CAD","CHF"];

// ============ STATE ============
let fromCur="USD",toCur="TWD",lastEdited="from";

// ============ DROPDOWN ============
function buildDropdown(listEl,searchEl,side){
    function render(q){
        q=(q||'').trim().toLowerCase();
        listEl.innerHTML='';
        const grouped={};groupOrder.forEach(g=>grouped[g]=[]);
        currencies.forEach(c=>{
            const code=c[0].toLowerCase(),name=c[2],flag=c[1];
            if(q&&!code.includes(q)&&!name.toLowerCase().includes(q))return;
            if(grouped[c[3]])grouped[c[3]].push(c);
        });
        let n=0;
        groupOrder.forEach(g=>{
            if(!grouped[g]||!grouped[g].length)return;
            const hdr=document.createElement('div');hdr.className='cdd-group';hdr.textContent=g;listEl.appendChild(hdr);
            grouped[g].forEach(c=>{
                const it=document.createElement('div');it.className='cdd-item';
                const sel=side==='from'?fromCur:toCur;
                if(c[0]===sel)it.classList.add('active');
                it.innerHTML='<span class="ci-flag">'+c[1]+'</span><span class="ci-code">'+c[0]+'</span><span class="ci-name">'+c[2]+'</span>';
                it.addEventListener('mousedown',e=>{
                    e.preventDefault();
                    if(side==='from'){fromCur=c[0];updateFromBtn()}else{toCur=c[0];updateToBtn()}
                    closeAll();convert();updatePopular();updateQuickChips();
                });
                listEl.appendChild(it);n++;
            });
        });
        if(!n){const d=document.createElement('div');d.className='cdd-item';d.textContent='No currency found';d.style.color='#94a3b8';listEl.appendChild(d)}
    }
    searchEl.addEventListener('input',()=>render(searchEl.value));
    return render;
}

const renderFromDD=buildDropdown(document.getElementById('fromList'),document.getElementById('fromSearch'),'from');
const renderToDD=buildDropdown(document.getElementById('toList'),document.getElementById('toSearch'),'to');

// Open/close
function closeAll(){
    document.querySelectorAll('.currency-dd').forEach(d=>d.classList.remove('show'));
    document.querySelectorAll('.currency-btn').forEach(b=>b.classList.remove('open'));
}

['from','to'].forEach(side=>{
    const btn=document.getElementById(side+'Btn');
    const dd=document.getElementById(side+'DD');
    const search=document.getElementById(side+'Search');
    btn.addEventListener('click',e=>{
        e.stopPropagation();
        const wasOpen=dd.classList.contains('show');
        closeAll();
        if(!wasOpen){
            dd.classList.add('show');btn.classList.add('open');
            search.value='';
            (side==='from'?renderFromDD:renderToDD)('');
            setTimeout(()=>search.focus(),50);
        }
    });
});
document.addEventListener('click',()=>closeAll());
document.querySelectorAll('.currency-dd').forEach(d=>d.addEventListener('click',e=>e.stopPropagation()));

// ============ UPDATE BUTTONS ============
function updateFromBtn(){
    const c=cMap[fromCur];
    document.getElementById('fromFlag').textContent=c.flag;
    document.getElementById('fromCode').textContent=c.code;
    document.getElementById('fromName').textContent=c.name;
}
function updateToBtn(){
    const c=cMap[toCur];
    document.getElementById('toFlag').textContent=c.flag;
    document.getElementById('toCode').textContent=c.code;
    document.getElementById('toName').textContent=c.name;
}

// ============ CONVERSION ============
function getRate(from,to){
    return cMap[to].rate/cMap[from].rate;
}
function fmtNum(n,decimals){
    if(n>=1000)decimals=Math.min(decimals,2);
    if(n>=100)decimals=Math.min(decimals,2);
    return n.toLocaleString('zh-TW',{minimumFractionDigits:decimals,maximumFractionDigits:decimals});
}
function smartDecimals(rate){
    if(rate>=1000)return 2;
    if(rate>=100)return 2;
    if(rate>=10)return 3;
    if(rate>=1)return 4;
    if(rate>=0.01)return 5;
    return 6;
}

function convert(){
    const fromInput=document.getElementById('fromAmount');
    const toInput=document.getElementById('toAmount');
    const rate=getRate(fromCur,toCur);
    const reverseRate=getRate(toCur,fromCur);

    if(lastEdited==='from'){
        const val=parseFloat(fromInput.value.replace(/,/g,''));
        if(isNaN(val)||fromInput.value.trim()===''){
            toInput.value='';
        }else{
            const result=val*rate;
            toInput.value=fmtNum(result,smartDecimals(result));
        }
    }else{
        const val=parseFloat(toInput.value.replace(/,/g,''));
        if(isNaN(val)||toInput.value.trim()===''){
            fromInput.value='';
        }else{
            const result=val*reverseRate;
            fromInput.value=fmtNum(result,smartDecimals(result));
        }
    }

    // Rate display
    const cf=cMap[fromCur],ct=cMap[toCur];
    const dec=smartDecimals(rate);
    const rdec=smartDecimals(reverseRate);
    document.getElementById('rateMain').textContent='1 '+cf.code+' '+cf.flag+' = '+fmtNum(rate,dec)+' '+ct.code+' '+ct.flag;
    document.getElementById('rateReverse').textContent='1 '+ct.code+' '+ct.flag+' = '+fmtNum(reverseRate,rdec)+' '+cf.code+' '+cf.flag;
}

// Input handling
const fromInput=document.getElementById('fromAmount');
const toInput=document.getElementById('toAmount');

fromInput.addEventListener('input',()=>{
    lastEdited='from';
    // Clean non-numeric chars except dot
    let v=fromInput.value.replace(/[^0-9.]/g,'');
    const parts=v.split('.');if(parts.length>2)v=parts[0]+'.'+parts.slice(1).join('');
    fromInput.value=v;
    convert();
});
fromInput.addEventListener('focus',()=>{lastEdited='from';fromInput.select()});

// Make toAmount editable too for bidirectional
toInput.removeAttribute('readonly');
toInput.addEventListener('input',()=>{
    lastEdited='to';
    let v=toInput.value.replace(/[^0-9.]/g,'');
    const parts=v.split('.');if(parts.length>2)v=parts[0]+'.'+parts.slice(1).join('');
    toInput.value=v;
    convert();
});
toInput.addEventListener('focus',()=>{lastEdited='to';toInput.select()});

// Swap
document.getElementById('swapBtn').addEventListener('click',()=>{
    const tmp=fromCur;fromCur=toCur;toCur=tmp;
    updateFromBtn();updateToBtn();
    // Also swap values
    const tmpVal=fromInput.value;fromInput.value=toInput.value;toInput.value=tmpVal;
    lastEdited='from';
    convert();updatePopular();updateQuickChips();
});

// ============ QUICK CHIPS ============
function updateQuickChips(){
    const container=document.getElementById('quickChips');
    container.innerHTML='';
    quickList.forEach(code=>{
        const c=cMap[code];if(!c)return;
        const chip=document.createElement('button');
        chip.className='quick-chip';
        if(code===fromCur||code===toCur)chip.classList.add('active');
        chip.innerHTML=c.flag+' '+c.code;
        chip.addEventListener('click',()=>{
            // If same as from, swap
            if(code===fromCur){
                // set as toCur
                toCur=code;updateToBtn();
            }else{
                toCur=code;updateToBtn();
            }
            lastEdited='from';
            convert();updatePopular();updateQuickChips();
        });
        container.appendChild(chip);
    });
}

// ============ POPULAR RATES TABLE ============
const popularCodes=["USD","EUR","GBP","JPY","CNY","KRW","HKD","THB","AUD","SGD","CAD","CHF"];
function updatePopular(){
    const grid=document.getElementById('rateGrid');
    grid.innerHTML='';
    const base=fromCur;
    const cf=cMap[base];
    document.getElementById('popularTitle').innerHTML='ğŸ“Š 1 '+cf.flag+' '+cf.code+' exchanges toâ€¦';
    popularCodes.forEach(code=>{
        if(code===base)return;
        const c=cMap[code];if(!c)return;
        const rate=getRate(base,code);
        const tile=document.createElement('div');tile.className='rate-tile';
        tile.innerHTML='<span class="rt-flag">'+c.flag+'</span><div class="rt-info"><div class="rt-code">'+c.code+'</div><div class="rt-name">'+c.name+'</div></div><div class="rt-rate">'+fmtNum(rate,smartDecimals(rate))+'</div>';
        tile.addEventListener('click',()=>{
            toCur=code;updateToBtn();lastEdited='from';convert();updatePopular();updateQuickChips();
            document.querySelector('.converter-card').scrollIntoView({behavior:'smooth',block:'start'});
        });
        grid.appendChild(tile);
    });
}

// ============ INIT ============
updateFromBtn();updateToBtn();convert();updateQuickChips();updatePopular();
</script>


</body></html>
