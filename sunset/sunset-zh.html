<!DOCTYPE html><html lang="zh-Hant"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roamwise - æ—¥å‡ºæ—¥è½æ™‚é–“æŸ¥è©¢</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&amp;display=swap" rel="stylesheet">
    <style>
        :root{--primary:#2563eb;--primary-dark:#1d4ed8;--primary-light:#dbeafe;--accent:#f59e0b;--bg:#f0f4f8;--card:#fff;--text:#1e293b;--text-light:#64748b;--border:#e2e8f0;--radius:12px;--shadow:0 4px 24px rgba(0,0,0,.07);--shadow-sm:0 2px 8px rgba(0,0,0,.05)}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans TC',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column}
        header{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;padding:0 24px;height:60px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:0 2px 12px rgba(37,99,235,.3)}
        .logo{font-size:1.4rem;font-weight:700;letter-spacing:1px;display:flex;align-items:center;gap:8px}.logo span{color:var(--accent)}
        .header-right{display:flex;align-items:center;gap:16px}
        .header-right a{color:rgba(255,255,255,.85);text-decoration:none;font-size:.9rem;transition:color .2s}.header-right a:hover{color:#fff}
        .lang-select{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.3);color:#fff;padding:6px 12px;border-radius:8px;font-size:.85rem;cursor:pointer;font-family:inherit}.lang-select option{color:#333;background:#fff}
        main{flex:1;max-width:900px;width:100%;margin:0 auto;padding:32px 16px}
        .page-title{text-align:center;font-size:1.7rem;font-weight:700;margin-bottom:24px;color:var(--primary-dark)}
        .info-box{background:var(--primary-light);border-left:4px solid var(--primary);border-radius:0 var(--radius) var(--radius) 0;padding:16px 20px;margin-bottom:28px;display:flex;gap:12px;align-items:flex-start;font-size:.92rem;color:var(--primary-dark);line-height:1.6}.info-box .icon{font-size:1.2rem;flex-shrink:0;margin-top:2px}
        .query-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px 24px;margin-bottom:28px}
        .selector-row{display:flex;gap:16px;align-items:flex-end;flex-wrap:wrap}
        .selector-group{flex:1;min-width:180px}
        .selector-group label{display:flex;align-items:center;gap:6px;font-weight:500;font-size:.95rem;margin-bottom:8px}
        .custom-select-wrapper{position:relative}
        .custom-select-wrapper input,.date-input{width:100%;padding:12px 16px;border:2px solid var(--border);border-radius:10px;font-size:1rem;font-family:inherit;transition:border-color .2s,box-shadow .2s;background:#fff}
        .custom-select-wrapper input:focus,.date-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.12)}
        .dropdown-list{position:absolute;top:calc(100% + 4px);left:0;right:0;background:#fff;border:1px solid var(--border);border-radius:10px;max-height:260px;overflow-y:auto;box-shadow:var(--shadow);z-index:50;display:none}.dropdown-list.show{display:block}
        .dropdown-item{padding:10px 16px;cursor:pointer;font-size:.93rem;transition:background .15s;display:flex;justify-content:space-between;align-items:center}.dropdown-item:hover,.dropdown-item.active{background:var(--primary-light);color:var(--primary-dark)}
        .dropdown-item .city-extra{font-size:.78rem;color:var(--text-light)}
        .dropdown-group-header{padding:8px 16px 4px;font-size:.78rem;font-weight:600;color:var(--primary);background:#f8fafc;text-transform:uppercase;letter-spacing:.5px;position:sticky;top:0}
        .search-btn-wrapper{flex-shrink:0}
        .search-btn{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;border:none;padding:12px 32px;border-radius:10px;font-size:1rem;font-family:inherit;font-weight:500;cursor:pointer;transition:transform .15s,box-shadow .2s;display:flex;align-items:center;gap:8px;white-space:nowrap}
        .search-btn:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(37,99,235,.35)}.search-btn:active{transform:translateY(0)}
        .no-result{text-align:center;padding:48px 20px;color:var(--text-light);display:none}.no-result .big-icon{font-size:2.5rem;margin-bottom:12px}
        .result-container{display:none}.result-container.show{display:block}
        .result-header{text-align:center;margin-bottom:24px}.result-header h2{font-size:1.4rem;color:var(--primary-dark);margin-bottom:6px}.result-header p{font-size:.92rem;color:var(--text-light)}
        .main-times{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px}
        .time-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow-sm);border:1px solid var(--border);padding:18px 14px;text-align:center}
        .time-card .t-icon{font-size:1.6rem;display:block;margin-bottom:6px}
        .time-card .t-label{font-size:.82rem;color:var(--text-light);display:block;margin-bottom:6px}
        .time-card .t-value{font-size:1.35rem;font-weight:700;color:var(--text);display:block;font-variant-numeric:tabular-nums;letter-spacing:1px}
        .time-card.sunrise{border-top:3px solid #f97316}.time-card.sunset{border-top:3px solid #8b5cf6}
        .time-card.daylen{border-top:3px solid #0ea5e9}.time-card.nightlen{border-top:3px solid #334155}
        .section-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow-sm);border:1px solid var(--border);padding:22px 20px;margin-bottom:20px}
        .section-card h3{font-size:1rem;font-weight:600;margin-bottom:16px;display:flex;align-items:center;gap:8px;color:var(--text)}
        .day-bar-wrap{position:relative;margin-bottom:8px}
        .day-bar{height:40px;border-radius:20px;overflow:hidden;position:relative}
        .bar-marker{position:absolute;top:0;height:100%;display:flex;flex-direction:column;align-items:center;transform:translateX(-50%);z-index:2;pointer-events:none}
        .bar-marker .m-line{width:2px;height:40px;flex-shrink:0}
        .bar-marker .m-line.white{background:rgba(255,255,255,.85)}.bar-marker .m-line.red{background:#dc2626;width:3px}
        .bar-marker .m-label{font-size:.68rem;margin-top:4px;white-space:nowrap;font-weight:500}
        .bar-marker .m-label.red{color:#dc2626;font-weight:700}
        .bar-hours{display:flex;justify-content:space-between;font-size:.7rem;color:var(--text-light);padding:4px 2px 0;user-select:none}
        .status-banner{padding:14px 18px;border-radius:var(--radius);margin-bottom:20px;font-weight:500;font-size:.95rem;display:flex;align-items:center;gap:10px;line-height:1.5}
        .status-banner.day{background:#fef3c7;color:#92400e;border:1px solid #fde68a}
        .status-banner.twilight{background:#e0e7ff;color:#3730a3;border:1px solid #c7d2fe}
        .status-banner.night{background:#1e293b;color:#94a3b8;border:1px solid #334155}
        .status-banner.polar{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}
        .detail-grid{display:grid;gap:0}
        .detail-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f1f5f9;font-size:.93rem}.detail-row:last-child{border-bottom:none}
        .detail-row .dl{color:var(--text-light)}.detail-row .dv{font-weight:600;text-align:right}
        .trend-table{width:100%;border-collapse:collapse;font-size:.88rem}
        .trend-table th{text-align:left;padding:8px 10px;font-weight:500;color:var(--text-light);border-bottom:2px solid var(--border);font-size:.82rem}
        .trend-table td{padding:8px 10px;border-bottom:1px solid #f1f5f9;font-variant-numeric:tabular-nums}
        .trend-table tr.today{background:#eff6ff;font-weight:600}
        .trend-table .change{font-size:.78rem;border-radius:20px;padding:2px 8px;display:inline-block}
        .change.up{background:#dcfce7;color:#15803d}.change.down{background:#fee2e2;color:#b91c1c}.change.same{background:#f1f5f9;color:#64748b}
        .calc-note{font-size:.82rem;color:var(--text-light);line-height:1.6;padding:12px 16px;background:#f8fafc;border-radius:8px;margin-top:20px}
        footer{background:#1e293b;color:rgba(255,255,255,.7);padding:36px 24px 20px;margin-top:auto}
        .footer-grid{max-width:900px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:28px;margin-bottom:28px}
        .footer-col h4{color:#fff;font-size:.95rem;margin-bottom:12px;display:flex;align-items:center;gap:6px}
        .footer-col a{display:block;color:rgba(255,255,255,.6);text-decoration:none;font-size:.88rem;padding:4px 0;transition:color .2s}.footer-col a:hover{color:#fff}
        .footer-col a.active-link{color:var(--accent);font-weight:500}
        .footer-bottom{text-align:center;border-top:1px solid rgba(255,255,255,.1);padding-top:16px;font-size:.82rem}.footer-bottom a{color:rgba(255,255,255,.5);text-decoration:none}.footer-bottom a:hover{color:#fff}
        @media(max-width:640px){
            .page-title{font-size:1.3rem}
            .selector-row{flex-direction:column}.selector-group{min-width:100%}
            .search-btn-wrapper{width:100%}.search-btn{width:100%;justify-content:center}
            .main-times{grid-template-columns:1fr 1fr}
            .time-card .t-value{font-size:1.15rem}
            .header-right a.contact-link{display:none}
        }
    </style>
</head>
<body>
<header>
    <div class="logo">Roam<span>wise</span></div>
    <div class="header-right">
        <a href="#" class="contact-link">è¯çµ¡æˆ‘å€‘</a>
        <select class="lang-select"><option selected="">ç¹é«”ä¸­æ–‡</option><option>English</option><option>EspaÃ±ol</option><option>PortuguÃªs</option><option>à¤¹à¤¿à¤¨à¥à¤¦à¥€</option></select>
    </div>
</header>
<main>
    <h1 class="page-title">ğŸŒ… æ—¥å‡ºæ—¥è½æ™‚é–“æŸ¥è©¢</h1>
    <div class="info-box"><span class="icon">â„¹ï¸</span><div>é¸æ“‡åŸå¸‚èˆ‡æ—¥æœŸï¼Œå³å¯æŸ¥è©¢æ—¥å‡ºæ—¥è½ã€æ›™æš®å…‰ã€ç™½å¤©é•·åº¦èˆ‡æ”å½±é»ƒé‡‘æ™‚åˆ»ç­‰è³‡è¨Šã€‚æ”¯æ´å…¨çƒè¶…é 115 åº§åŸå¸‚ï¼Œä½¿ç”¨å¤©æ–‡æ¼”ç®—æ³•å³æ™‚è¨ˆç®—ã€‚</div></div>
    <div class="query-card">
        <div class="selector-row">
            <div class="selector-group" style="flex:2">
                <label>ğŸ™ï¸ é¸æ“‡åŸå¸‚</label>
                <div class="custom-select-wrapper">
                    <input type="text" id="cityInput" placeholder="è¼¸å…¥åŸå¸‚æˆ–åœ‹å®¶åç¨±â€¦" autocomplete="off">
                    <div class="dropdown-list" id="cityDropdown"></div>
                </div>
            </div>
            <div class="selector-group" style="flex:1">
                <label>ğŸ“… æ—¥æœŸ</label>
                <input type="date" class="date-input" id="dateInput">
            </div>
            <div class="search-btn-wrapper">
                <button class="search-btn" id="searchBtn">ğŸ” æŸ¥è©¢</button>
            </div>
        </div>
    </div>
    <div class="no-result" id="noResult"><div class="big-icon">ğŸ”</div><p>æŸ¥ç„¡è³‡æ–™</p><p style="font-size:.85rem">è«‹ç¢ºèªåŸå¸‚åç¨±æ˜¯å¦æ­£ç¢ºï¼Œæˆ–å¾ä¸‹æ‹‰é¸å–®ä¸­é¸å–</p></div>
    <div class="result-container" id="resultContainer">
        <div class="result-header"><h2 id="rHeader"></h2><p id="rSubheader"></p></div>
        <div class="main-times">
            <div class="time-card sunrise"><span class="t-icon">ğŸŒ…</span><span class="t-label">æ—¥å‡º</span><span class="t-value" id="rSunrise">--:--</span></div>
            <div class="time-card sunset"><span class="t-icon">ğŸŒ‡</span><span class="t-label">æ—¥è½</span><span class="t-value" id="rSunset">--:--</span></div>
            <div class="time-card daylen"><span class="t-icon">â˜€ï¸</span><span class="t-label">ç™½å¤©é•·åº¦</span><span class="t-value" id="rDayLen">--</span></div>
            <div class="time-card nightlen"><span class="t-icon">ğŸŒ™</span><span class="t-label">å¤œæ™šé•·åº¦</span><span class="t-value" id="rNightLen">--</span></div>
        </div>
        <div class="section-card">
            <h3>ğŸ• æ—¥ç…§æ™‚é–“è»¸</h3>
            <div class="day-bar-wrap">
                <div class="day-bar" id="dayBar"></div>
            </div>
            <div class="bar-hours"><span>00</span><span>03</span><span>06</span><span>09</span><span>12</span><span>15</span><span>18</span><span>21</span><span>24</span></div>
        </div>
        <div class="status-banner" id="statusBanner"></div>
        <div class="section-card">
            <h3>ğŸ“‹ è©³ç´°æ™‚åˆ»</h3>
            <div class="detail-grid">
                <div class="detail-row"><span class="dl">å¤©æ–‡æ›™æš®å…‰ï¼ˆ-18Â°ï¼‰</span><span class="dv" id="rAstro"></span></div>
                <div class="detail-row"><span class="dl">èˆªæµ·æ›™æš®å…‰ï¼ˆ-12Â°ï¼‰</span><span class="dv" id="rNaut"></span></div>
                <div class="detail-row"><span class="dl">æ°‘ç”¨æ›™æš®å…‰ï¼ˆ-6Â°ï¼‰</span><span class="dv" id="rCivil"></span></div>
                <div class="detail-row"><span class="dl">æ—¥å‡º / æ—¥è½</span><span class="dv" id="rOfficial"></span></div>
                <div class="detail-row"><span class="dl">å¤ªé™½æ­£åˆ</span><span class="dv" id="rNoon"></span></div>
                <div class="detail-row"><span class="dl">æ­£åˆæœ€é«˜ä»°è§’</span><span class="dv" id="rElev"></span></div>
            </div>
        </div>
        <div class="section-card">
            <h3>ğŸ“· æ”å½±é»ƒé‡‘æ™‚åˆ»</h3>
            <div class="detail-grid">
                <div class="detail-row"><span class="dl">ğŸŒ… æ™¨é–“é»ƒé‡‘æ™‚åˆ»</span><span class="dv" id="rGoldAM"></span></div>
                <div class="detail-row"><span class="dl">ğŸŒ† å‚æ™šé»ƒé‡‘æ™‚åˆ»</span><span class="dv" id="rGoldPM"></span></div>
                <div class="detail-row"><span class="dl">ğŸ”µ æ™¨é–“è—è‰²æ™‚åˆ»</span><span class="dv" id="rBlueAM"></span></div>
                <div class="detail-row"><span class="dl">ğŸ”µ å‚æ™šè—è‰²æ™‚åˆ»</span><span class="dv" id="rBluePM"></span></div>
            </div>
        </div>
        <div class="section-card">
            <h3>ğŸ“Š å‰å¾Œä¸€æ—¥æ¯”è¼ƒ</h3>
            <table class="trend-table">
                <thead><tr><th>æ—¥æœŸ</th><th>æ—¥å‡º</th><th>æ—¥è½</th><th>ç™½å¤©é•·åº¦</th><th>è®ŠåŒ–</th></tr></thead>
                <tbody id="trendBody"></tbody>
            </table>
        </div>
        <div class="calc-note">âš ï¸ ä»¥ä¸Šç‚ºå¤©æ–‡æ¼”ç®—æ³•è¿‘ä¼¼è¨ˆç®—çµæœï¼Œå¯èƒ½èˆ‡å¯¦éš›æ™‚é–“æœ‰ 1ï½2 åˆ†é˜èª¤å·®ï¼Œä¸”æœªè€ƒæ…®åœ°å½¢é®è”½èˆ‡å±€éƒ¨å¤§æ°£æŠ˜å°„è®ŠåŒ–ã€‚æ¥µåœ°é™„è¿‘åŸå¸‚åœ¨å¤è‡³æˆ–å†¬è‡³å‰å¾Œå¯èƒ½å‡ºç¾æ°¸æ™æˆ–æ°¸å¤œã€‚</div>
    </div>
</main>
<footer>
    <div class="footer-grid">
        <div class="footer-col"><h4>ğŸ”Œ é›»åŠ›èˆ‡æ™‚é–“</h4><a href="#">æ’é ­è¦æ ¼æŸ¥è©¢</a><a href="#">æ™‚å€æŸ¥è©¢</a><a href="#" class="active-link">æ—¥å‡ºæ—¥è½æ™‚é–“</a></div>
        <div class="footer-col"><h4>ğŸ‰ å‡æœŸèˆ‡ç¯€æ…¶</h4><a href="#">å„åœ‹åœ‹å®šå‡æ—¥</a><a href="#">ç¯€æ…¶æ´»å‹•ä¸€è¦½</a></div>
        <div class="footer-col"><h4>ğŸ’± é‡‘èèˆ‡å–®ä½</h4><a href="#">åŒ¯ç‡æ›ç®—</a><a href="#">å–®ä½è½‰æ›</a></div>
        <div class="footer-col"><h4>ğŸŒ æ—…éŠè³‡è¨Š</h4><a href="#">åœ‹å®¶æ¦‚è¦½</a><a href="#">å„åœ°è©³ç´°æŒ‡å—</a></div>
    </div>
    <div class="footer-bottom">Â© 2026 Roamwise. All rights reserved. | <a href="#">éš±ç§æ¬Šæ”¿ç­–</a> | <a href="#">ä½¿ç”¨æ¢æ¬¾</a></div>
</footer>
<script>
// ============ CITY DATA ============
// [city, country, region, iana, lat, lng]
const raw=[
["å°åŒ—","å°ç£","äºæ´²","Asia/Taipei",25.03,121.57],
["é«˜é›„","å°ç£","äºæ´²","Asia/Taipei",22.63,120.30],
["æ±äº¬","æ—¥æœ¬","äºæ´²","Asia/Tokyo",35.68,139.65],
["å¤§é˜ª","æ—¥æœ¬","äºæ´²","Asia/Tokyo",34.69,135.50],
["äº¬éƒ½","æ—¥æœ¬","äºæ´²","Asia/Tokyo",35.01,135.77],
["åŒ—äº¬","ä¸­åœ‹","äºæ´²","Asia/Shanghai",39.90,116.41],
["ä¸Šæµ·","ä¸­åœ‹","äºæ´²","Asia/Shanghai",31.23,121.47],
["å»£å·","ä¸­åœ‹","äºæ´²","Asia/Shanghai",23.13,113.26],
["æ·±åœ³","ä¸­åœ‹","äºæ´²","Asia/Shanghai",22.54,114.06],
["é‡æ…¶","ä¸­åœ‹","äºæ´²","Asia/Shanghai",29.43,106.91],
["æˆéƒ½","ä¸­åœ‹","äºæ´²","Asia/Shanghai",30.57,104.07],
["é¦™æ¸¯","é¦™æ¸¯","äºæ´²","Asia/Hong_Kong",22.32,114.17],
["æ¾³é–€","æ¾³é–€","äºæ´²","Asia/Macau",22.20,113.54],
["é¦–çˆ¾","å—éŸ“","äºæ´²","Asia/Seoul",37.57,126.98],
["é‡œå±±","å—éŸ“","äºæ´²","Asia/Seoul",35.18,129.08],
["æ›¼è°·","æ³°åœ‹","äºæ´²","Asia/Bangkok",13.76,100.50],
["æ¸…é‚","æ³°åœ‹","äºæ´²","Asia/Bangkok",18.79,98.99],
["æ™®å‰å³¶","æ³°åœ‹","äºæ´²","Asia/Bangkok",7.88,98.39],
["èƒ¡å¿—æ˜å¸‚","è¶Šå—","äºæ´²","Asia/Ho_Chi_Minh",10.82,106.63],
["æ²³å…§","è¶Šå—","äºæ´²","Asia/Ho_Chi_Minh",21.03,105.83],
["æ–°åŠ å¡","æ–°åŠ å¡","äºæ´²","Asia/Singapore",1.35,103.82],
["å‰éš†å¡","é¦¬ä¾†è¥¿äº","äºæ´²","Asia/Kuala_Lumpur",3.14,101.69],
["é›…åŠ é”","å°å°¼","äºæ´²","Asia/Jakarta",-6.21,106.85],
["å³‡é‡Œå³¶","å°å°¼","äºæ´²","Asia/Makassar",-8.34,115.09],
["é¦¬å°¼æ‹‰","è²å¾‹è³“","äºæ´²","Asia/Manila",14.60,120.98],
["å®¿éœ§","è²å¾‹è³“","äºæ´²","Asia/Manila",10.32,123.89],
["æ–°å¾·é‡Œ","å°åº¦","äºæ´²","Asia/Kolkata",28.61,77.21],
["å­Ÿè²·","å°åº¦","äºæ´²","Asia/Kolkata",19.08,72.88],
["ç­åŠ ç¾…çˆ¾","å°åº¦","äºæ´²","Asia/Kolkata",12.97,77.59],
["å¯å€«å¡","æ–¯é‡Œè˜­å¡","äºæ´²","Asia/Colombo",6.93,79.86],
["åŠ å¾·æ»¿éƒ½","å°¼æ³Šçˆ¾","äºæ´²","Asia/Kathmandu",27.72,85.32],
["é‡‘é‚Š","æŸ¬åŸ”å¯¨","äºæ´²","Asia/Phnom_Penh",11.56,104.93],
["æš¹ç²’","æŸ¬åŸ”å¯¨","äºæ´²","Asia/Phnom_Penh",13.36,103.86],
["ä»°å…‰","ç·¬ç”¸","äºæ´²","Asia/Yangon",16.87,96.20],
["æ°¸ç","å¯®åœ‹","äºæ´²","Asia/Vientiane",17.98,102.63],
["é”å¡","å­ŸåŠ æ‹‰","äºæ´²","Asia/Dhaka",23.81,90.41],
["å–€æ‹‰èš©","å·´åŸºæ–¯å¦","äºæ´²","Asia/Karachi",24.86,67.00],
["ä¼Šæ–¯è˜­å ¡","å·´åŸºæ–¯å¦","äºæ´²","Asia/Karachi",33.68,73.05],
["æœæ‹œ","é˜¿è¯é…‹","ä¸­æ±","Asia/Dubai",25.20,55.27],
["é˜¿å¸ƒé”æ¯”","é˜¿è¯é…‹","ä¸­æ±","Asia/Dubai",24.45,54.38],
["åˆ©é›…å¾·","æ²™çƒåœ°é˜¿æ‹‰ä¼¯","ä¸­æ±","Asia/Riyadh",24.71,46.68],
["å¤šå“ˆ","å¡é”","ä¸­æ±","Asia/Qatar",25.29,51.53],
["è€¶è·¯æ’’å†·","ä»¥è‰²åˆ—","ä¸­æ±","Asia/Jerusalem",31.77,35.21],
["ç‰¹æ‹‰ç¶­å¤«","ä»¥è‰²åˆ—","ä¸­æ±","Asia/Jerusalem",32.09,34.78],
["å®‰æ›¼","ç´„æ—¦","ä¸­æ±","Asia/Amman",31.95,35.93],
["ä¼Šæ–¯å¦å ¡","åœŸè€³å…¶","ä¸­æ±","Europe/Istanbul",41.01,28.98],
["é¦¬ç´¯","é¦¬çˆ¾åœ°å¤«","ä¸­æ±","Indian/Maldives",4.18,73.51],
["å€«æ•¦","è‹±åœ‹","æ­æ´²","Europe/London",51.51,-0.13],
["æ„›ä¸å ¡","è‹±åœ‹","æ­æ´²","Europe/London",55.95,-3.19],
["æ›¼å¾¹æ–¯ç‰¹","è‹±åœ‹","æ­æ´²","Europe/London",53.48,-2.24],
["å·´é»","æ³•åœ‹","æ­æ´²","Europe/Paris",48.86,2.35],
["å°¼æ–¯","æ³•åœ‹","æ­æ´²","Europe/Paris",43.71,7.26],
["æŸæ—","å¾·åœ‹","æ­æ´²","Europe/Berlin",52.52,13.41],
["æ…•å°¼é»‘","å¾·åœ‹","æ­æ´²","Europe/Berlin",48.14,11.58],
["æ³•è˜­å…‹ç¦","å¾·åœ‹","æ­æ´²","Europe/Berlin",50.11,8.68],
["ç¾…é¦¬","ç¾©å¤§åˆ©","æ­æ´²","Europe/Rome",41.90,12.50],
["ç±³è˜­","ç¾©å¤§åˆ©","æ­æ´²","Europe/Rome",45.46,9.19],
["å¨å°¼æ–¯","ç¾©å¤§åˆ©","æ­æ´²","Europe/Rome",45.44,12.32],
["é¦¬å¾·é‡Œ","è¥¿ç­ç‰™","æ­æ´²","Europe/Madrid",40.42,-3.70],
["å·´å¡éš†ç´","è¥¿ç­ç‰™","æ­æ´²","Europe/Madrid",41.39,2.17],
["é‡Œæ–¯æœ¬","è‘¡è„ç‰™","æ­æ´²","Europe/Lisbon",38.72,-9.14],
["é˜¿å§†æ–¯ç‰¹ä¸¹","è·è˜­","æ­æ´²","Europe/Amsterdam",52.37,4.90],
["å¸ƒé­¯å¡çˆ¾","æ¯”åˆ©æ™‚","æ­æ´²","Europe/Brussels",50.85,4.35],
["è˜‡é»ä¸–","ç‘å£«","æ­æ´²","Europe/Zurich",47.38,8.54],
["æ—¥å…§ç“¦","ç‘å£«","æ­æ´²","Europe/Zurich",46.20,6.14],
["ç¶­ä¹Ÿç´","å¥§åœ°åˆ©","æ­æ´²","Europe/Vienna",48.21,16.37],
["æ–¯å¾·å“¥çˆ¾æ‘©","ç‘å…¸","æ­æ´²","Europe/Stockholm",59.33,18.07],
["å¥§æ–¯é™¸","æŒªå¨","æ­æ´²","Europe/Oslo",59.91,10.75],
["å“¥æœ¬å“ˆæ ¹","ä¸¹éº¥","æ­æ´²","Europe/Copenhagen",55.68,12.57],
["èµ«çˆ¾è¾›åŸº","èŠ¬è˜­","æ­æ´²","Europe/Helsinki",60.17,24.94],
["é›·å…‹é›…ç¶­å…‹","å†°å³¶","æ­æ´²","Atlantic/Reykjavik",64.15,-21.94],
["éƒ½æŸæ—","æ„›çˆ¾è˜­","æ­æ´²","Europe/Dublin",53.35,-6.26],
["é›…å…¸","å¸Œè‡˜","æ­æ´²","Europe/Athens",37.98,23.73],
["è¯æ²™","æ³¢è˜­","æ­æ´²","Europe/Warsaw",52.23,21.01],
["å¸ƒæ‹‰æ ¼","æ·å…‹","æ­æ´²","Europe/Prague",50.08,14.44],
["å¸ƒé”ä½©æ–¯","åŒˆç‰™åˆ©","æ­æ´²","Europe/Budapest",47.50,19.04],
["æœ­æ ¼é›·å¸ƒ","å…‹ç¾…åŸƒè¥¿äº","æ­æ´²","Europe/Zagreb",45.82,15.98],
["è«æ–¯ç§‘","ä¿„ç¾…æ–¯","æ­æ´²","Europe/Moscow",55.76,37.62],
["è–å½¼å¾—å ¡","ä¿„ç¾…æ–¯","æ­æ´²","Europe/Moscow",59.93,30.36],
["è‘‰å¡æ·ç³å ¡","ä¿„ç¾…æ–¯","æ­æ´²","Asia/Yekaterinburg",56.84,60.61],
["æ–°è¥¿ä¼¯åˆ©äº","ä¿„ç¾…æ–¯","æ­æ´²","Asia/Novosibirsk",55.01,82.94],
["æµ·åƒå´´","ä¿„ç¾…æ–¯","æ­æ´²","Asia/Vladivostok",43.13,131.91],
["åŸºè¼”","çƒå…‹è˜­","æ­æ´²","Europe/Kyiv",50.45,30.52],
["é‡ŒåŠ ","æ‹‰è„«ç¶­äº","æ­æ´²","Europe/Riga",56.95,24.11],
["è’™ç‰¹å¡æ´›","æ‘©ç´å“¥","æ­æ´²","Europe/Monaco",43.74,7.42],
["ç´ç´„","ç¾åœ‹","åŒ—ç¾æ´²","America/New_York",40.71,-74.01],
["è¯ç››é “ç‰¹å€","ç¾åœ‹","åŒ—ç¾æ´²","America/New_York",38.91,-77.04],
["æ³¢å£«é “","ç¾åœ‹","åŒ—ç¾æ´²","America/New_York",42.36,-71.06],
["é‚é˜¿å¯†","ç¾åœ‹","åŒ—ç¾æ´²","America/New_York",25.76,-80.19],
["äºç‰¹è˜­å¤§","ç¾åœ‹","åŒ—ç¾æ´²","America/New_York",33.75,-84.39],
["èŠåŠ å“¥","ç¾åœ‹","åŒ—ç¾æ´²","America/Chicago",41.88,-87.63],
["ä¼‘å£«é “","ç¾åœ‹","åŒ—ç¾æ´²","America/Chicago",29.76,-95.37],
["é”æ‹‰æ–¯","ç¾åœ‹","åŒ—ç¾æ´²","America/Chicago",32.78,-96.80],
["ä¸¹ä½›","ç¾åœ‹","åŒ—ç¾æ´²","America/Denver",39.74,-104.99],
["é³³å‡°åŸ","ç¾åœ‹","åŒ—ç¾æ´²","America/Phoenix",33.45,-112.07],
["æ´›æ‰ç£¯","ç¾åœ‹","åŒ—ç¾æ´²","America/Los_Angeles",34.05,-118.24],
["èˆŠé‡‘å±±","ç¾åœ‹","åŒ—ç¾æ´²","America/Los_Angeles",37.77,-122.42],
["è¥¿é›…åœ–","ç¾åœ‹","åŒ—ç¾æ´²","America/Los_Angeles",47.61,-122.33],
["æ‹‰æ–¯ç¶­åŠ æ–¯","ç¾åœ‹","åŒ—ç¾æ´²","America/Los_Angeles",36.17,-115.14],
["å®‰å…‹æ‹‰æ²»","ç¾åœ‹","åŒ—ç¾æ´²","America/Anchorage",61.22,-149.90],
["æª€é¦™å±±","ç¾åœ‹","åŒ—ç¾æ´²","Pacific/Honolulu",21.31,-157.86],
["å¤šå€«å¤š","åŠ æ‹¿å¤§","åŒ—ç¾æ´²","America/Toronto",43.65,-79.38],
["è’™ç‰¹å©","åŠ æ‹¿å¤§","åŒ—ç¾æ´²","America/Toronto",45.50,-73.57],
["æ¸¥å¤ªè¯","åŠ æ‹¿å¤§","åŒ—ç¾æ´²","America/Toronto",45.42,-75.70],
["å¡åŠ åˆ©","åŠ æ‹¿å¤§","åŒ—ç¾æ´²","America/Edmonton",51.04,-114.07],
["æº«å“¥è¯","åŠ æ‹¿å¤§","åŒ—ç¾æ´²","America/Vancouver",49.28,-123.12],
["å¢¨è¥¿å“¥åŸ","å¢¨è¥¿å“¥","åŒ—ç¾æ´²","America/Mexico_City",19.43,-99.13],
["åæ˜†","å¢¨è¥¿å“¥","åŒ—ç¾æ´²","America/Cancun",21.16,-86.85],
["å“ˆç“¦é‚£","å¤å·´","åŒ—ç¾æ´²","America/Havana",23.11,-82.37],
["å·´æ‹¿é¦¬åŸ","å·´æ‹¿é¦¬","åŒ—ç¾æ´²","America/Panama",8.98,-79.52],
["è–è·è¥¿","å“¥æ–¯å¤§é»åŠ ","åŒ—ç¾æ´²","America/Costa_Rica",9.93,-84.09],
["è–ä¿ç¾…","å·´è¥¿","å—ç¾æ´²","America/Sao_Paulo",-23.55,-46.63],
["é‡Œç´„ç†±å…§ç›§","å·´è¥¿","å—ç¾æ´²","America/Sao_Paulo",-22.91,-43.17],
["å¸ƒå®œè«¾æ–¯è‰¾åˆ©æ–¯","é˜¿æ ¹å»·","å—ç¾æ´²","America/Argentina/Buenos_Aires",-34.60,-58.38],
["è–åœ°ç‰™å“¥","æ™ºåˆ©","å—ç¾æ´²","America/Santiago",-33.45,-70.67],
["æ³¢å“¥å¤§","å“¥å€«æ¯”äº","å—ç¾æ´²","America/Bogota",4.71,-74.07],
["åˆ©é¦¬","ç§˜é­¯","å—ç¾æ´²","America/Lima",-12.05,-77.04],
["è’™ç‰¹ç¶­å¤š","çƒæ‹‰åœ­","å—ç¾æ´²","America/Montevideo",-34.90,-56.16],
["é›ªæ¢¨","æ¾³æ´²","å¤§æ´‹æ´²","Australia/Sydney",-33.87,151.21],
["å¢¨çˆ¾æœ¬","æ¾³æ´²","å¤§æ´‹æ´²","Australia/Melbourne",-37.81,144.96],
["å¸ƒé‡Œæ–¯æœ¬","æ¾³æ´²","å¤§æ´‹æ´²","Australia/Brisbane",-27.47,153.03],
["ä¼¯æ–¯","æ¾³æ´²","å¤§æ´‹æ´²","Australia/Perth",-31.95,115.86],
["é˜¿å¾·èŠå¾·","æ¾³æ´²","å¤§æ´‹æ´²","Australia/Adelaide",-34.93,138.60],
["å¥§å…‹è˜­","ç´è¥¿è˜­","å¤§æ´‹æ´²","Pacific/Auckland",-36.85,174.76],
["å¨éˆé “","ç´è¥¿è˜­","å¤§æ´‹æ´²","Pacific/Auckland",-41.29,174.78],
["è˜‡ç“¦","æ–æ¿Ÿ","å¤§æ´‹æ´²","Pacific/Fiji",-18.14,178.44],
["é–‹ç¾…","åŸƒåŠ","éæ´²","Africa/Cairo",30.04,31.24],
["ç´„ç¿°å°¼æ–¯å ¡","å—é","éæ´²","Africa/Johannesburg",-26.20,28.05],
["é–‹æ™®æ•¦","å—é","éæ´²","Africa/Johannesburg",-33.92,18.42],
["å¥ˆæ´›æ¯”","è‚¯äº","éæ´²","Africa/Nairobi",-1.29,36.82],
["å¡è–©å¸ƒè˜­åŠ ","æ‘©æ´›å“¥","éæ´²","Africa/Casablanca",33.57,-7.59],
["é¦¬æ‹‰å–€ä»€","æ‘©æ´›å“¥","éæ´²","Africa/Casablanca",31.63,-7.98],
["æ‹‰å“¥æ–¯","å¥ˆåŠåˆ©äº","éæ´²","Africa/Lagos",6.52,3.38],
["ä¸‰è˜­æ¸¯","å¦å°šå°¼äº","éæ´²","Africa/Dar_es_Salaam",-6.79,39.21],
["é˜¿å…‹æ‹‰","è¿¦ç´","éæ´²","Africa/Accra",5.60,-0.19],
["é˜¿è¿ªæ–¯é˜¿è²å·´","è¡£ç´¢æ¯”äº","éæ´²","Africa/Addis_Ababa",9.03,38.75]
];

const regionOrder=["äºæ´²","ä¸­æ±","æ­æ´²","åŒ—ç¾æ´²","å—ç¾æ´²","å¤§æ´‹æ´²","éæ´²"];
const cities=raw.map(r=>({city:r[0],country:r[1],region:r[2],iana:r[3],lat:r[4],lng:r[5],label:r[0]+"ï¼ˆ"+r[1]+"ï¼‰"}));
const cityMap={};cities.forEach(c=>cityMap[c.label]=c);

// ============ DROPDOWN ============
(function(){
    const input=document.getElementById('cityInput'),dd=document.getElementById('cityDropdown');
    function render(f){
        f=(f||'').trim().toLowerCase();
        const m=f?cities.filter(c=>c.city.toLowerCase().includes(f)||c.country.toLowerCase().includes(f)):cities;
        const g={};regionOrder.forEach(r=>g[r]=[]);m.forEach(c=>{if(g[c.region])g[c.region].push(c)});
        dd.innerHTML='';let n=0;
        regionOrder.forEach(r=>{if(!g[r]||!g[r].length)return;const h=document.createElement('div');h.className='dropdown-group-header';h.textContent=r;dd.appendChild(h);
            g[r].forEach(c=>{const d=document.createElement('div');d.className='dropdown-item';d.innerHTML='<span>'+c.city+'ï¼ˆ'+c.country+'ï¼‰</span><span class="city-extra">'+c.lat.toFixed(1)+'Â°, '+c.lng.toFixed(1)+'Â°</span>';
            d.addEventListener('mousedown',e=>{e.preventDefault();input.value=c.label;dd.classList.remove('show')});dd.appendChild(d);n++})});
        if(!n){const d=document.createElement('div');d.className='dropdown-item';d.textContent='æ‰¾ä¸åˆ°ç›¸ç¬¦çš„åŸå¸‚';d.style.color='#94a3b8';dd.appendChild(d)}
    }
    input.addEventListener('focus',()=>{render(input.value);dd.classList.add('show')});
    input.addEventListener('input',()=>{render(input.value);dd.classList.add('show')});
    input.addEventListener('blur',()=>setTimeout(()=>dd.classList.remove('show'),200));
})();

// Default date = today
document.getElementById('dateInput').valueAsDate=new Date();

// ============ SUN CALCULATION ============
function getOffset(iana,y,m,d){
    const dt=new Date(Date.UTC(y,m-1,d,12,0,0));
    const u=dt.toLocaleString('en-US',{timeZone:'UTC'});
    const t=dt.toLocaleString('en-US',{timeZone:iana});
    return(new Date(t)-new Date(u))/36e5;
}
function doy(y,m,d){return Math.floor((new Date(y,m-1,d)-new Date(y,0,0))/864e5)}
function calcSun(lat,lng,y,m,d,iana){
    const off=getOffset(iana,y,m,d);
    const n=doy(y,m,d);
    const gamma=(2*Math.PI/365)*(n-1+0.5);
    const eqtime=229.18*(0.000075+0.001868*Math.cos(gamma)-0.032077*Math.sin(gamma)-0.014615*Math.cos(2*gamma)-0.040849*Math.sin(2*gamma));
    const decl=0.006918-0.399912*Math.cos(gamma)+0.070257*Math.sin(gamma)-0.006758*Math.cos(2*gamma)+0.000907*Math.sin(2*gamma)-0.002697*Math.cos(3*gamma)+0.00148*Math.sin(3*gamma);
    const snoon=720-4*lng-eqtime+off*60;
    const latR=lat*Math.PI/180;
    function getTimes(zenith){
        const zR=zenith*Math.PI/180;
        const cosH=(Math.cos(zR)-Math.sin(latR)*Math.sin(decl))/(Math.cos(latR)*Math.cos(decl));
        if(cosH>1)return{state:'never_rises'};
        if(cosH<-1)return{state:'never_sets'};
        const ha=Math.acos(cosH)*180/Math.PI;
        return{rise:snoon-ha*4,set:snoon+ha*4};
    }
    const official=getTimes(90.833);
    const civil=getTimes(96);
    const nautical=getTimes(102);
    const astro=getTimes(108);
    const golden=getTimes(84);
    const declDeg=decl*180/Math.PI;
    let maxElev=90-Math.abs(lat-declDeg);
    if(maxElev<0)maxElev=0;
    return{official,civil,nautical,astro,golden,snoon,maxElev,declDeg,off};
}

// ============ FORMATTING ============
function mt(m){
    if(!m&&m!==0||isNaN(m))return'--:--';
    let h=Math.floor(m/60),mn=Math.round(m%60);
    if(mn===60){h++;mn=0}h=((h%24)+24)%24;
    return String(h).padStart(2,'0')+':'+String(mn).padStart(2,'0');
}
function dur(m){
    if(!m&&m!==0||isNaN(m))return'--';
    m=Math.round(m);const h=Math.floor(m/60),mn=m%60;
    return h+' æ™‚ '+mn+' åˆ†';
}
function fmtDate(y,m,d){
    const dt=new Date(y,m-1,d);
    const wd=['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][dt.getDay()];
    return y+'å¹´'+m+'æœˆ'+d+'æ—¥ï¼ˆæ˜ŸæœŸ'+wd+'ï¼‰';
}

// ============ SEARCH ============
document.getElementById('searchBtn').addEventListener('click',doSearch);
document.getElementById('cityInput').addEventListener('keydown',e=>{if(e.key==='Enter')doSearch()});

function doSearch(){
    const cVal=document.getElementById('cityInput').value.trim();
    const dStr=document.getElementById('dateInput').value;
    const noR=document.getElementById('noResult'),res=document.getElementById('resultContainer');
    const c=cityMap[cVal];
    if(!c||!dStr){noR.style.display='block';res.classList.remove('show');return}
    noR.style.display='none';res.classList.add('show');
    const[y,m,d]=dStr.split('-').map(Number);
    const sun=calcSun(c.lat,c.lng,y,m,d,c.iana);

    // Header
    document.getElementById('rHeader').textContent='ğŸ™ï¸ '+c.city+'ï¼ˆ'+c.country+'ï¼‰';
    document.getElementById('rSubheader').textContent='ğŸ“… '+fmtDate(y,m,d)+'ã€€ğŸ“ '+c.lat.toFixed(2)+'Â°N, '+c.lng.toFixed(2)+'Â°E';

    // Main times
    if(sun.official.state){
        const isPolar=sun.official.state==='never_rises';
        document.getElementById('rSunrise').textContent=isPolar?'ä¸å‡èµ·':'ä¸è½ä¸‹';
        document.getElementById('rSunset').textContent=isPolar?'ä¸å‡èµ·':'ä¸è½ä¸‹';
        document.getElementById('rDayLen').textContent=isPolar?'0 æ™‚ 0 åˆ†':'24 æ™‚ 0 åˆ†';
        document.getElementById('rNightLen').textContent=isPolar?'24 æ™‚ 0 åˆ†':'0 æ™‚ 0 åˆ†';
    }else{
        document.getElementById('rSunrise').textContent=mt(sun.official.rise);
        document.getElementById('rSunset').textContent=mt(sun.official.set);
        const dayMins=sun.official.set-sun.official.rise;
        document.getElementById('rDayLen').textContent=dur(dayMins);
        document.getElementById('rNightLen').textContent=dur(1440-dayMins);
    }

    // Visual bar
    renderBar(sun);

    // Status
    renderStatus(c,sun,y,m,d);

    // Details
    document.getElementById('rAstro').textContent=sun.astro.state?'â€”':mt(sun.astro.rise)+' / '+mt(sun.astro.set);
    document.getElementById('rNaut').textContent=sun.nautical.state?'â€”':mt(sun.nautical.rise)+' / '+mt(sun.nautical.set);
    document.getElementById('rCivil').textContent=sun.civil.state?'â€”':mt(sun.civil.rise)+' / '+mt(sun.civil.set);
    document.getElementById('rOfficial').textContent=sun.official.state?'â€”':mt(sun.official.rise)+' / '+mt(sun.official.set);
    document.getElementById('rNoon').textContent=mt(sun.snoon);
    document.getElementById('rElev').textContent=sun.maxElev.toFixed(1)+'Â°';

    // Photography
    if(!sun.official.state&&!sun.golden.state){
        document.getElementById('rGoldAM').textContent=mt(sun.official.rise)+' ~ '+mt(sun.golden.rise);
        document.getElementById('rGoldPM').textContent=mt(sun.golden.set)+' ~ '+mt(sun.official.set);
    }else{
        document.getElementById('rGoldAM').textContent='â€”';
        document.getElementById('rGoldPM').textContent='â€”';
    }
    if(!sun.official.state&&!sun.civil.state){
        document.getElementById('rBlueAM').textContent=mt(sun.civil.rise)+' ~ '+mt(sun.official.rise);
        document.getElementById('rBluePM').textContent=mt(sun.official.set)+' ~ '+mt(sun.civil.set);
    }else{
        document.getElementById('rBlueAM').textContent='â€”';
        document.getElementById('rBluePM').textContent='â€”';
    }

    // Trend
    renderTrend(c,y,m,d);

    res.scrollIntoView({behavior:'smooth',block:'start'});
}

// ============ VISUAL BAR ============
function renderBar(sun){
    const bar=document.getElementById('dayBar');
    bar.innerHTML='';
    function pct(m){return Math.max(0,Math.min(100,m/1440*100))}

    if(sun.official.state){
        bar.style.background=sun.official.state==='never_rises'?'linear-gradient(135deg,#0f172a,#1e293b)':'linear-gradient(135deg,#38bdf8,#7dd3fc)';
        bar.style.height='40px';bar.style.borderRadius='20px';return;
    }
    const cd=sun.civil.state?pct(sun.official.rise):pct(sun.civil.rise);
    const sr=pct(sun.official.rise);
    const ss=pct(sun.official.set);
    const ck=sun.civil.state?pct(sun.official.set):pct(sun.civil.set);

    bar.style.background=`linear-gradient(to right,#0f172a 0%,#0f172a ${cd}%,#334155 ${cd}%,#fb923c ${sr}%,#fbbf24 ${sr}%,#38bdf8 ${sr+3>ss-3?sr:sr+3}%,#38bdf8 ${ss-3<sr+3?ss:ss-3}%,#fbbf24 ${ss}%,#fb923c ${ss}%,#334155 ${ck}%,#0f172a ${ck}%,#0f172a 100%)`;
    bar.style.height='40px';bar.style.borderRadius='20px';bar.style.position='relative';bar.style.overflow='visible';

    function addMarker(mins,label,color){
        const mk=document.createElement('div');mk.className='bar-marker';mk.style.left=pct(mins)+'%';
        const ln=document.createElement('div');ln.className='m-line '+(color==='red'?'red':'white');
        const lb=document.createElement('div');lb.className='m-label'+(color==='red'?' red':'');lb.textContent=label;
        mk.appendChild(ln);mk.appendChild(lb);bar.appendChild(mk);
    }
    addMarker(sun.official.rise,mt(sun.official.rise),'white');
    addMarker(sun.official.set,mt(sun.official.set),'white');
    addMarker(sun.snoon,'æ­£åˆ','white');

    // Current time marker if today
    const today=new Date();const ds=document.getElementById('dateInput').value;
    const todayStr=today.getFullYear()+'-'+String(today.getMonth()+1).padStart(2,'0')+'-'+String(today.getDate()).padStart(2,'0');
    if(ds===todayStr){
        try{
            const nowStr=today.toLocaleTimeString('en-US',{timeZone:cities.find(x=>x.label===document.getElementById('cityInput').value.trim())?.iana||'UTC',hour12:false,hour:'2-digit',minute:'2-digit'});
            const[nh,nm]=nowStr.split(':').map(Number);
            addMarker(nh*60+nm,'ç¾åœ¨','red');
        }catch(e){}
    }
}

// ============ STATUS BANNER ============
function renderStatus(c,sun,y,m,d){
    const banner=document.getElementById('statusBanner');
    const today=new Date();
    const todayStr=today.getFullYear()+'-'+String(today.getMonth()+1).padStart(2,'0')+'-'+String(today.getDate()).padStart(2,'0');
    const ds=document.getElementById('dateInput').value;
    if(ds!==todayStr){
        banner.className='status-banner day';
        banner.innerHTML='ğŸ“… é¡¯ç¤ºçš„æ˜¯ '+fmtDate(y,m,d)+' çš„è³‡æ–™ï¼ˆéä»Šæ—¥ï¼‰';return;
    }
    if(sun.official.state){
        banner.className='status-banner polar';
        banner.innerHTML=sun.official.state==='never_rises'?'ğŸŒ‘ æ°¸å¤œ â€” ä»Šæ—¥å¤ªé™½ä¸æœƒå‡èµ·':'â˜€ï¸ æ°¸æ™ â€” ä»Šæ—¥å¤ªé™½ä¸æœƒè½ä¸‹';return;
    }
    try{
        const nowStr=today.toLocaleTimeString('en-US',{timeZone:c.iana,hour12:false,hour:'2-digit',minute:'2-digit'});
        const[nh,nm]=nowStr.split(':').map(Number);const now=nh*60+nm;
        const sr=sun.official.rise,ss=sun.official.set;
        const cd=sun.civil.state?sr:sun.civil.rise,ck=sun.civil.state?ss:sun.civil.set;
        if(now<cd){banner.className='status-banner night';banner.innerHTML='ğŸŒ‘ å¤œæ™š â€” è·é›¢å¤©äº®ç´„ '+dur(cd-now)}
        else if(now<sr){banner.className='status-banner twilight';banner.innerHTML='ğŸŒ† æ›™å…‰ â€” è·é›¢æ—¥å‡ºç´„ '+dur(sr-now)}
        else if(now<ss){banner.className='status-banner day';banner.innerHTML='â˜€ï¸ ç™½å¤© â€” è·é›¢æ—¥è½ç´„ '+dur(ss-now)}
        else if(now<ck){banner.className='status-banner twilight';banner.innerHTML='ğŸŒ† æš®å…‰ â€” è·é›¢å¤©é»‘ç´„ '+dur(ck-now)}
        else{banner.className='status-banner night';banner.innerHTML='ğŸŒ‘ å¤œæ™š â€” ä»Šæ—¥å¤ªé™½å·²è½ä¸‹'}
    }catch(e){banner.className='status-banner day';banner.innerHTML='ğŸ“ '+c.city+'ç•¶åœ°æ™‚é–“è³‡è¨Š'}
}

// ============ TREND TABLE ============
function renderTrend(c,y,m,d){
    const tbody=document.getElementById('trendBody');tbody.innerHTML='';
    const dates=[];
    for(let i=-1;i<=1;i++){
        const dt=new Date(y,m-1,d+i);
        dates.push({y:dt.getFullYear(),m:dt.getMonth()+1,d:dt.getDate(),offset:i});
    }
    let prevDayLen=null;
    dates.forEach(dt=>{
        const s=calcSun(c.lat,c.lng,dt.y,dt.m,dt.d,c.iana);
        const tr=document.createElement('tr');
        if(dt.offset===0)tr.className='today';
        const dateLabel=dt.offset===-1?'å‰ä¸€å¤©':dt.offset===0?'â–¶ '+dt.m+'/'+dt.d:' å¾Œä¸€å¤©';
        let srT='â€”',ssT='â€”',dlT='â€”',dayLen=null;
        if(!s.official.state){
            srT=mt(s.official.rise);ssT=mt(s.official.set);
            dayLen=s.official.set-s.official.rise;dlT=dur(dayLen);
        }else if(s.official.state==='never_sets'){dayLen=1440;dlT='24 æ™‚ 0 åˆ†';srT='ä¸è½ä¸‹';ssT='ä¸è½ä¸‹'}
        else{dayLen=0;dlT='0 æ™‚ 0 åˆ†';srT='ä¸å‡èµ·';ssT='ä¸å‡èµ·'}
        let changeHtml='';
        if(prevDayLen!==null&&dayLen!==null){
            const diff=Math.round(dayLen-prevDayLen);
            if(diff>0)changeHtml='<span class="change up">+'+diff+' åˆ†</span>';
            else if(diff<0)changeHtml='<span class="change down">'+diff+' åˆ†</span>';
            else changeHtml='<span class="change same">Â±0</span>';
        }
        prevDayLen=dayLen;
        tr.innerHTML='<td>'+dateLabel+'</td><td>'+srT+'</td><td>'+ssT+'</td><td>'+dlT+'</td><td>'+changeHtml+'</td>';
        tbody.appendChild(tr);
    });
}
</script>


</body></html>